{"version":3,"sources":["components/util/constants.js","components/layer.jsx","components/util/support.js","components/layerproperties.jsx","components/layerlist.jsx","components/processingfield.jsx","components/processingtemplate.jsx","components/processing/attributeselector.jsx","components/processing/operationtypes.js","components/processing/buffer.js","components/processing/difference.js","components/processing/intersection.js","components/processing/union.js","App.js","components/geoprocessing.jsx","components/upload.jsx","components/sidebar.jsx","components/leafletmap.jsx","registerServiceWorker.js","index.js","images/icondelete.svg","images/iconzoom.svg","images/iconsettings.svg","images/iconinfo.svg","images/buffer.png","images/intersection.png","images/union.png","images/difference.png"],"names":["SHAPE_FORMATS","ItemTypes","InputTypes","PropTypes","number","isRequired","string","object","boolean","Actions","delete","zoom","properties","Layer","handleClick","action","_this","props","onDelete","layer","id","onZoom","openPopup","createContexMenu","react_default","a","createElement","es6","index","toString","createContexMenuItem","settingsIcon","divider","zoomIcon","deleteIcon","description","icon","onClick","src","className","alt","clipName","name","length","substring","concat","_this2","this","_this$props","isDragging","isOver","connectDragSource","connectDropTarget","style","opacity","backgroundColor","holdToDisplay","height","width","float","color","type","checked","visible","onChange","onToggle","Component","flow","DragSource","beginDrag","draggedId","draggedIndex","draggedName","draggedData","data","connect","monitor","dragSource","DropTarget","canDrop","getItem","drop","didDrop","onMove","dropTarget","validateNumberInput","inputValue","defaultValue","newValue","i","char","charAt","isNaN","Number","InputValues","Properties","Object","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","handleTextInput","evt","inputName","target","value","setState","prevState","inputs","set","handleRangeInput","min","max","String","ValidateRangeInput","applyChanges","onNameChange","state","get","onStyleChange","removeDialogue","onDialogueFinished","createPage","Fragment","textInput","colorInput","rangeInput","onEdit","Map","LayerList","stylemap","closePopup","reactjs_popup_es","open","modal","onClose","layerproperties","layerlist","map","components_layer","key","visiblemap","ProcessingField","hasLayer","canMove","inputLayers","border","cursor","canDrag","_monitor$getItem2","onDrop","ProcessingTemplate","getDefaultValues","inputValues","defaultInputs","forEach","push","defaultInput","createInputFields","operation","inputFields","createInputField","inputType","splice","event","handleInputValue","createLayerFields","processingfield","layers","onSwap","handleSwap","handleDrop","position","checkLayers","indexOf","find","currentIndex","nextIndex","handleReset","Array","fill","processing","processingStart","_this$state","undefined","canProcess","popup","startProcessing","script","processFinished","onProcessingDone","alert","listOpen","PopupComponent","popupComponent","onExecute","info","trigger","infoIcon","on","disabled","ComparisonMethods","equal","notEqual","greater","less","greaterEqual","lessEqual","AttributeType","property","operator","AttributeSelector","loadAttributes","featureID","features","feature","setDataType","dataTypes","assign","checkFilters","newName","extractedLayer","fulfill","filterID","filters","filter","fulfillCriteria","onCancel","addSelectField","firstProperty","keys","getFilterForProperty","getLegalComparators","dataType","values","deleteSelection","pos","handleSelectionUpdate","createSelectFields","selectFields","comparators","createSelectField","valueChoices","defaultChoice","handleNameChange","operations","createInputValue","bufferValue","shouldDissolve","bufferLayer","buffer","units","dissolvedFeature","union","geometryChanged","bufferImg","layer1","layer2","resultLayer","resultData","buffer1","buffer2","nextFeature","j","difference","differenceImg","feature1","feature2","intersectPolygon","intersect","intersectionImg","unionImg","db","componentOperations","Geoprocessing","handleToggle","createProcessingTemplate","processingtemplate","Upload","handleUpload","files","shapeFiles","gmlFiles","geoJsonFiles","file","filename","toLowerCase","endsWith","format","onUpload","es","accept","SideBar","geoprocessing","upload","LeafletMap","mapid","center","zoomToLayer","getLayerById","fitBounds","getBounds","addLayer","leaflayer","L","geoJSON","featuregroup","e","onError","removeLayer","getLayers","createMap","featureGroup","addTo","setView","tileLayer","attribution","zoomControl","setPosition","setStyle","bringToBack","DB_NAME","LAYER_STORE","DB_VERSION","App","dbInit","request","indexedDB","onerror","onupgradeneeded","result","createObjectStore","keyPath","autoIncrement","onsuccess","loadLayers","transaction","objectStore","getAll","addGeoJSONLayer","json","reader","FileReader","onload","datatext","JSON","parse","replace","localSave","ex","readAsText","put","console","log","styles","visibility","x","Math","round","random","y","getColor","handleDelete","deleteFromStorage","deleteFromState","deleteFromLeaflet","handleZoom","leafletmap","current","handleStyleChange","prevStyle","l","handleError","handleMove","newIndex","layerInfo","arraylist","t","getInfo","handleProcessing","React","createRef","close","components_sidebar","ref","DragDropContext","HTML5Backend","isLocalhost","Boolean","window","location","hostname","match","registerValidSW","swUrl","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","controller","catch","error","ReactDOM","render","src_App_0","document","getElementById","URL","process","origin","addEventListener","fetch","response","status","headers","ready","unregister","reload","checkValidServiceWorker","registerServiceWorker","module","exports","__webpack_require__","p"],"mappings":"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","file":"static/js/main.2fabd2f6.chunk.js","sourcesContent":["import PropTypes from \"prop-types\";\r\n/**\r\n * Class for global constants\r\n */\r\nexport const ACCEPTED_FILE_TYPES = \".geojson\"; //, .gml, .dbf, .prj, .sbn, .sbx, .shp, .shx, .shp.xml\";\r\nexport const SHAPE_FORMATS = [\r\n  \".shp\",\r\n  \".dbf\",\r\n  \".prj\",\r\n  \".sbn\",\r\n  \".sbx\",\r\n  \".shx\",\r\n  \".shp.xml\"\r\n];\r\n/**\r\n * Targets and sources for drag and drop functionality.\r\n * Use these keywords when making draggable layer,\r\n * a droppable field for layers in an operation etc...\r\n */\r\nexport const ItemTypes = {\r\n  LAYER: \"layer\",\r\n  OPERATION: \"operation\"\r\n};\r\n/**\r\n * Proptypes template for layers\r\n */\r\nexport const LayerShape = {\r\n  id: PropTypes.number.isRequired,\r\n  name: PropTypes.string.isRequired,\r\n  data: PropTypes.object.isRequired\r\n};\r\n/**\r\n * Proptypes template for operations\r\n */\r\nexport const OperationShape = {\r\n  name: PropTypes.string.isRequired,\r\n  inputLayers: PropTypes.number.isRequired\r\n};\r\n/**\r\n * Object of string containing all valid inputtypes of user data\r\n */\r\nexport const InputTypes = {\r\n  number: \"number\",\r\n  boolean: \"boolean\",\r\n  string: \"string\"\r\n};\r\n","import React, { Component } from \"react\";\r\nimport { DragSource, DropTarget } from \"react-dnd\";\r\nimport { ItemTypes, LayerShape } from \"./util/constants\";\r\nimport \"./css/sidebar.css\";\r\nimport \"./css/contextmenu.css\";\r\nimport \"./css/popup.css\";\r\n\r\nimport flow from \"lodash/flow\";\r\nimport PropTypes from \"prop-types\";\r\nimport { ContextMenu, MenuItem, ContextMenuTrigger } from \"react-contextmenu\";\r\nimport zoomIcon from \"../images/iconzoom.svg\";\r\nimport settingsIcon from \"../images/iconsettings.svg\";\r\nimport deleteIcon from \"../images/icondelete.svg\";\r\n\r\n/**\r\n * The different actions in the layers right click menu\r\n */\r\nconst Actions = {\r\n  delete: \"delete\",\r\n  zoom: \"zoom\",\r\n  properties: \"properties\"\r\n};\r\n\r\n/**\r\n * Also must be dropped in processingfield. Use itemtypes operation for that\r\n */\r\nconst layerSource = {\r\n  beginDrag(props) {\r\n    const item = {\r\n      draggedId: props.layer.id,\r\n      draggedIndex: props.index,\r\n      draggedName: props.layer.name,\r\n      draggedData: props.layer.data\r\n    };\r\n    return item;\r\n  }\r\n};\r\nconst layerTarget = {\r\n  //Cannot drop on the same layer\r\n  canDrop(props, monitor) {\r\n    let { draggedId } = monitor.getItem();\r\n    return draggedId !== props.layer.id;\r\n  },\r\n  //App handles sorting of the layer list\r\n  drop(props, monitor) {\r\n    if (!monitor.didDrop()) {\r\n      let { draggedId } = monitor.getItem();\r\n      props.onMove(draggedId, props.index);\r\n    }\r\n  }\r\n};\r\n\r\nfunction collectTarget(connect, monitor) {\r\n  return {\r\n    connectDropTarget: connect.dropTarget(),\r\n    isOver: monitor.isOver()\r\n  };\r\n}\r\nfunction collectSource(connect, monitor) {\r\n  return {\r\n    connectDragSource: connect.dragSource(),\r\n    isDragging: monitor.isDragging()\r\n  };\r\n}\r\n/**\r\n * Class for visualizing the geojson layer in the sidebar\r\n */\r\nclass Layer extends Component {\r\n  /**\r\n   * Method to decide which item was clicked and perform corresponding action\r\n   */\r\n  handleClick = action => {\r\n    if (action === Actions.delete) {\r\n      this.props.onDelete(this.props.layer.id);\r\n    } else if (action === Actions.zoom) {\r\n      this.props.onZoom(this.props.layer.id);\r\n    } else if (action === Actions.properties) {\r\n      this.props.openPopup(this.props.layer);\r\n    }\r\n  };\r\n  /**\r\n   * Creates right click menu for render function.\r\n   * Uses createContexMenuItem for every item in the list\r\n   */\r\n  createContexMenu = () => {\r\n    return (\r\n      <div>\r\n        <ContextMenu id={this.props.index.toString()}>\r\n          {this.createContexMenuItem(\r\n            Actions.properties,\r\n            \"Properties\",\r\n            settingsIcon\r\n          )}\r\n          <MenuItem divider />\r\n          {this.createContexMenuItem(Actions.zoom, \"Zoom to layer\", zoomIcon)}\r\n          <MenuItem divider />\r\n          {this.createContexMenuItem(\r\n            Actions.delete,\r\n            \"Delete layer\",\r\n            deleteIcon\r\n          )}\r\n        </ContextMenu>\r\n      </div>\r\n    );\r\n  };\r\n  /**\r\n   * Each item in the right click menu\r\n   * Has onClick function, description and a small icon\r\n   */\r\n  createContexMenuItem = (action, description, icon) => {\r\n    return (\r\n      <MenuItem onClick={() => this.handleClick(action)}>\r\n        {description}\r\n        <img src={icon} className=\"icon\" alt=\"\" />\r\n      </MenuItem>\r\n    );\r\n  };\r\n  /**\r\n   * Reduce too long layer names when shown to the user\r\n   */\r\n  clipName = () => {\r\n    let name = this.props.layer.name;\r\n    if (name.length > 24) {\r\n      name = name.substring(0, 25);\r\n      name = name.concat(\"...\");\r\n    }\r\n    return name;\r\n  };\r\n  /**\r\n   * Render function\r\n   * Contains right click menu with options\r\n   * Name of layer\r\n   * Square with color of layer\r\n   * Checkbox for toggling visibility\r\n   */\r\n  render() {\r\n    const {\r\n      isDragging,\r\n      isOver,\r\n      connectDragSource,\r\n      connectDropTarget\r\n    } = this.props;\r\n    return connectDragSource(\r\n      connectDropTarget(\r\n        <div\r\n          className=\"layer\"\r\n          style={{\r\n            opacity: isDragging ? 0 : 1,\r\n            backgroundColor: isOver\r\n              ? \"rgb(120, 120, 120)\"\r\n              : \"rgb(217, 217, 217)\"\r\n          }}\r\n        >\r\n          <ContextMenuTrigger\r\n            id={this.props.index.toString()}\r\n            holdToDisplay={-1}\r\n          >\r\n            <span>{this.clipName()}</span>\r\n            {/*FIXME: Overflow of name/Size */}\r\n            <div\r\n              style={{\r\n                height: \"20px\",\r\n                width: \"20px\",\r\n                float: \"left\",\r\n                backgroundColor: this.props.style.color\r\n              }}\r\n            />\r\n            <input\r\n              type=\"checkbox\"\r\n              style={{ float: \"right\" }}\r\n              checked={this.props.visible}\r\n              onChange={() => this.props.onToggle(this.props.layer.id)}\r\n            />\r\n          </ContextMenuTrigger>\r\n          {this.createContexMenu()}\r\n        </div>\r\n      )\r\n    );\r\n  }\r\n}\r\n\r\nLayer.propTypes = {\r\n  layer: PropTypes.shape(LayerShape).isRequired,\r\n  index: PropTypes.number.isRequired,\r\n  isDragging: PropTypes.bool.isRequired,\r\n  isOver: PropTypes.bool.isRequired,\r\n  onMove: PropTypes.func\r\n};\r\n\r\nexport default flow(\r\n  DragSource(ItemTypes.LAYER, layerSource, collectSource),\r\n  DropTarget(ItemTypes.LAYER, layerTarget, collectTarget)\r\n)(Layer);\r\n","/**\r\n * Class for support functions\r\n */\r\n/**\r\n * Returns the index and content of the object with matching id in arraylist\r\n * @param {*} id\r\n * @param {*} arraylist\r\n */\r\nexport function getInfo(id, arraylist) {\r\n  const target = arraylist.find(t => t.id === id);\r\n  const index = arraylist.indexOf(target);\r\n  return { index: index, info: target };\r\n}\r\n\r\n/**\r\n * Gives a random color to a layer\r\n */\r\nexport function getColor(id) {\r\n  var x = Math.round(0xffffff * Math.random()).toString(16);\r\n  var y = 6 - x.length;\r\n  var z = \"000000\";\r\n  var z1 = z.substring(0, y);\r\n  return \"#\" + z1 + x;\r\n}\r\n/**\r\n * Checks if the input is a number, removes all parts of the inputvalue which are not numbers\r\n * Currently returns empty string if input is empty. Can return defaultvalue instead\r\n */\r\nexport function validateNumberInput(inputValue, defaultValue) {\r\n  if (inputValue.length === 0) {\r\n    return \"\";\r\n  }\r\n  let newValue = \"\";\r\n  for (let i = 0; i < inputValue.length; i++) {\r\n    let char = inputValue.charAt(i);\r\n    //Check if the char is a number\r\n    if (!isNaN(Number(char))) {\r\n      newValue += char;\r\n    }\r\n  }\r\n  return newValue.length > 0\r\n    ? Number(newValue)\r\n    : defaultValue !== null\r\n    ? defaultValue\r\n    : \"\";\r\n}\r\n","import React, { Component } from \"react\";\r\nimport \"./css/sidebar.css\";\r\nimport { validateNumberInput } from \"./util/support.js\";\r\nconst InputValues = {\r\n  name: \"Name: \",\r\n  color: \"Color: \",\r\n  opacity: \"Opacity: \"\r\n};\r\n/**\r\n * Class for the popup menu which allows changing properties of a layer\r\n */\r\nclass Properties extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    //Map input type to inputvalue\r\n    const inputs = new Map([\r\n      [InputValues.name, props.layer.name],\r\n      [InputValues.color, props.style.color],\r\n      [InputValues.opacity, props.style.opacity]\r\n    ]);\r\n    this.state = {\r\n      inputs: inputs\r\n    };\r\n  }\r\n  /**\r\n   * How textinput should be handled. Can check if the input is valid, nonempty...\r\n   */\r\n  handleTextInput = (evt, inputName, defaultValue) => {\r\n    let newValue = evt.target.value;\r\n    this.setState(prevState => {\r\n      return { inputs: prevState.inputs.set(inputName, newValue) };\r\n    });\r\n  };\r\n  /**\r\n   * Handle numerical input with min and max value.\r\n   * Remove all non-numerical values from input, check if remainder is not empty.\r\n   * If not empty, compare to min and max, if empty set as empty string\r\n   */\r\n  handleRangeInput = (evt, inputName, defaultValue, min, max) => {\r\n    let newValue = validateNumberInput(evt.target.value, defaultValue);\r\n    newValue =\r\n      String(newValue).length > 0\r\n        ? this.ValidateRangeInput(newValue / 100, defaultValue, min, max)\r\n        : \"\";\r\n    this.setState(prevState => {\r\n      return { inputs: prevState.inputs.set(inputName, newValue) };\r\n    });\r\n  };\r\n  /**\r\n   * Checks if inputValue is within the constraints. If not, returns max or min values\r\n   */\r\n  ValidateRangeInput = (inputValue, defaultValue, min, max) => {\r\n    if (Number(inputValue) < min) {\r\n      inputValue = min;\r\n    } else if (Number(inputValue) > max) {\r\n      inputValue = max;\r\n    }\r\n    return inputValue;\r\n  };\r\n  /**\r\n   * Calls App with changes to properties the user have entered.\r\n   * Validation is done in App component, we send null if the field should not be changes\r\n   */\r\n  applyChanges = () => {\r\n    this.props.onNameChange(\r\n      this.props.layer,\r\n      this.state.inputs.get(InputValues.name)\r\n    );\r\n    const color = this.state.inputs.get(InputValues.color);\r\n    const opacity = this.state.inputs.get(InputValues.opacity);\r\n    this.props.onStyleChange(this.props.layer.id, {\r\n      color: color.length > 0 ? color : null,\r\n      opacity: String(opacity).length > 0 ? opacity : null\r\n    });\r\n    this.removeDialogue();\r\n  };\r\n  /**\r\n   * Call parent to close properties popup\r\n   */\r\n  removeDialogue = () => {\r\n    this.props.onDialogueFinished();\r\n  };\r\n  /**\r\n   * Create the content of properties menu.\r\n   * Contains each property and a field for changing them in a vertial list\r\n   */\r\n  createPage = () => {\r\n    return (\r\n      <React.Fragment>\r\n        {this.textInput(\r\n          InputValues.name,\r\n          this.state.inputs.get(InputValues.name),\r\n          this.handleTextInput\r\n        )}\r\n        {this.colorInput(\r\n          InputValues.color,\r\n          this.state.inputs.get(InputValues.color),\r\n          this.handleTextInput\r\n        )}\r\n        {this.rangeInput(\r\n          InputValues.opacity,\r\n          String(this.state.inputs.get(InputValues.opacity)).length > 0\r\n            ? this.state.inputs.get(InputValues.opacity) * 100\r\n            : \"\",\r\n          0,\r\n          1,\r\n          this.handleRangeInput\r\n        )}\r\n        <button onClick={this.removeDialogue}>Cancel</button>\r\n        <button onClick={this.applyChanges}>Apply</button>\r\n      </React.Fragment>\r\n    );\r\n  };\r\n  textInput = (inputName, defaultValue, onEdit) => {\r\n    return (\r\n      <div>\r\n        {inputName}\r\n        <input\r\n          type=\"text\"\r\n          value={defaultValue}\r\n          onChange={evt => onEdit(evt, inputName, defaultValue)}\r\n        />\r\n      </div>\r\n    );\r\n  };\r\n  rangeInput = (inputName, defaultValue, min, max, onEdit) => {\r\n    return (\r\n      <div>\r\n        {inputName}\r\n        <input\r\n          type=\"text\"\r\n          style={{ width: \"50px\" }}\r\n          value={defaultValue}\r\n          onChange={evt => onEdit(evt, inputName, defaultValue, min, max)}\r\n        />\r\n        {\"%\"}\r\n      </div>\r\n    );\r\n  };\r\n  colorInput = (inputName, defaultValue, onEdit) => {\r\n    return (\r\n      <div>\r\n        {inputName}\r\n        <input\r\n          type=\"color\"\r\n          value={defaultValue}\r\n          onChange={evt => onEdit(evt, inputName, defaultValue)}\r\n        />\r\n      </div>\r\n    );\r\n  };\r\n  render() {\r\n    return (\r\n      <div className=\"properties-menu\">\r\n        {\"Layer properties\"}\r\n        {this.createPage()}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Properties;\r\n","import React, { Component } from \"react\";\r\nimport Layer from \"./layer\";\r\nimport \"./css/sidebar.css\";\r\nimport \"./css/popup.css\";\r\nimport PropTypes from \"prop-types\";\r\nimport { LayerShape } from \"./util/constants.js\";\r\nimport Properties from \"./layerproperties\";\r\nimport Popup from \"reactjs-popup\";\r\n\r\n/**\r\n * Class for listing all layers in the sidebar. Contains all layers\r\n */\r\nclass LayerList extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      openPopup: false,\r\n      layer: null,\r\n      style: null\r\n    };\r\n  }\r\n  /**\r\n   * Open properties popup for specific layer\r\n   */\r\n  openPopup = layer => {\r\n    this.setState({\r\n      openPopup: true,\r\n      layer: layer,\r\n      style: this.props.stylemap.get(layer.id)\r\n    });\r\n  };\r\n  closePopup = () => {\r\n    this.setState({\r\n      openPopup: false,\r\n      layer: null,\r\n      style: null\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Render function\r\n   * Contains popup with layer properties\r\n   * All layers in a vertical list under the title\r\n   */\r\n  render() {\r\n    return (\r\n      <div>\r\n        <div className=\"group-divider\">Layers</div>\r\n        <Popup open={this.state.openPopup} modal onClose={this.closePopup}>\r\n          <Properties\r\n            layer={this.state.layer}\r\n            style={this.state.style}\r\n            onNameChange={this.props.onNameChange}\r\n            onStyleChange={this.props.onStyleChange}\r\n            onDialogueFinished={this.closePopup}\r\n          />\r\n        </Popup>\r\n        {this.props.layerlist.map((layer, index) => (\r\n          <Layer\r\n            key={layer.id}\r\n            index={index}\r\n            layer={layer}\r\n            visible={this.props.visiblemap.get(layer.id)}\r\n            style={this.props.stylemap.get(layer.id)}\r\n            onDelete={this.props.onDelete}\r\n            onToggle={this.props.onToggle}\r\n            onMove={this.props.onMove}\r\n            onZoom={this.props.onZoom}\r\n            openPopup={this.openPopup}\r\n          />\r\n        ))}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nLayerList.propTypes = {\r\n  layerlist: PropTypes.arrayOf(PropTypes.shape(LayerShape)),\r\n  visiblemap: PropTypes.instanceOf(Map).isRequired,\r\n  onMove: PropTypes.func.isRequired,\r\n  layer: PropTypes.shape(LayerShape),\r\n  index: PropTypes.number,\r\n  visible: PropTypes.bool\r\n};\r\n\r\nexport default LayerList;\r\n","import React, { Component } from \"react\";\r\nimport { DragSource, DropTarget } from \"react-dnd\";\r\nimport PropTypes from \"prop-types\";\r\nimport { ItemTypes, LayerShape } from \"./util/constants.js\";\r\nimport flow from \"lodash/flow\";\r\nimport \"./css/sidebar.css\";\r\n\r\nconst operationSource = {\r\n  //The dragged item has id, name and data of layer\r\n  beginDrag(props) {\r\n    const item = {\r\n      draggedId: props.layer.id,\r\n      draggedName: props.layer.name,\r\n      draggedData: props.layer.data\r\n    };\r\n    return item;\r\n  },\r\n  //Can not drag if one one possible layer, or if no layer is present\r\n  canDrag(props) {\r\n    if (props.inputLayers > 1) {\r\n      return props.layer !== null;\r\n    }\r\n    return false;\r\n  }\r\n};\r\nconst operationTarget = {\r\n  //Can drop if the field is empty, or if the layer has a different id from the dragged layer\r\n  canDrop(props, monitor) {\r\n    if (props.layer === null) {\r\n      return true;\r\n    }\r\n    const { draggedId } = monitor.getItem();\r\n    return props.layer.id !== draggedId;\r\n  },\r\n  //Template handles the drop logic in its handleDrop function\r\n  drop(props, monitor) {\r\n    if (!monitor.didDrop()) {\r\n      const { draggedId, draggedName, draggedData } = monitor.getItem();\r\n      const layer = { id: draggedId, name: draggedName, data: draggedData };\r\n      props.onDrop(layer, props.index);\r\n    }\r\n  }\r\n};\r\n\r\nfunction collectTarget(connect, monitor) {\r\n  return {\r\n    connectDropTarget: connect.dropTarget(),\r\n    isOver: monitor.isOver()\r\n  };\r\n}\r\nfunction collectSource(connect, monitor) {\r\n  return {\r\n    connectDragSource: connect.dragSource(),\r\n    isDragging: monitor.isDragging()\r\n  };\r\n}\r\n/**\r\n * Class for the droppable layer field in each operation.\r\n * Layers can be dropped from the layer list or from other processingfields\r\n */\r\nclass ProcessingField extends Component {\r\n  /**\r\n   * Render function\r\n   * Contains a field which layers can be dropped on\r\n   */\r\n  render() {\r\n    const {\r\n      isDragging,\r\n      isOver,\r\n      connectDragSource,\r\n      connectDropTarget\r\n    } = this.props;\r\n    const hasLayer = this.props.layer !== null;\r\n    const canMove = hasLayer && this.props.inputLayers > 1;\r\n\r\n    return connectDragSource(\r\n      connectDropTarget(\r\n        <div\r\n          className=\"processing-field\"\r\n          style={{\r\n            opacity: isDragging ? 0 : isOver ? 0.8 : 1,\r\n            border: !hasLayer ? \"2px dotted black\" : \"2px solid black\",\r\n            cursor: canMove ? \"pointer\" : \"default\"\r\n          }}\r\n        >\r\n          {(!hasLayer && \"Drop layer \" + (this.props.index + 1) + \" here\") ||\r\n            (hasLayer && this.props.layer.name)}\r\n        </div>\r\n      )\r\n    );\r\n  }\r\n}\r\n\r\nProcessingField.propTypes = {\r\n  layer: PropTypes.shape(LayerShape),\r\n  hasLayer: PropTypes.bool,\r\n  isDragging: PropTypes.bool,\r\n  isOver: PropTypes.bool,\r\n  inputLayers: PropTypes.number.isRequired\r\n};\r\n\r\nexport default flow(\r\n  DragSource(ItemTypes.OPERATION, operationSource, collectSource),\r\n  DropTarget(\r\n    [ItemTypes.LAYER, ItemTypes.OPERATION],\r\n    operationTarget,\r\n    collectTarget\r\n  )\r\n)(ProcessingField);\r\n","import React, { Component } from \"react\";\r\nimport ProcessingField from \"./processingfield\";\r\nimport PropTypes from \"prop-types\";\r\nimport { OperationShape, LayerShape, InputTypes } from \"./util/constants\";\r\nimport \"./css/sidebar.css\";\r\nimport \"./css/popup.css\";\r\nimport { validateNumberInput } from \"./util/support.js\";\r\nimport infoIcon from \"../images/iconinfo.svg\";\r\nimport Popup from \"reactjs-popup\";\r\n\r\n/**\r\n * Base class for operations in the sidebar. Creates inputfields\r\n * and initiates the processing operation on the input layers\r\n */\r\nclass ProcessingTemplate extends Component {\r\n  /**\r\n   * Populates the template with default values for user input, if required,\r\n   * and array for inputlayers\r\n   */\r\n  constructor(props) {\r\n    super(props);\r\n    const defaultInputs = this.getDefaultValues(props.operation.inputValues);\r\n    this.state = {\r\n      layers: new Array(props.operation.inputLayers).fill(null),\r\n      inputs: defaultInputs,\r\n      processing: false\r\n    };\r\n  }\r\n  /**\r\n   * Returns array of all default inputvalues for the inputfields, or null if no inputvalues\r\n   */\r\n  getDefaultValues = inputValues => {\r\n    let defaultInputs = null;\r\n    if (inputValues) {\r\n      defaultInputs = [];\r\n      inputValues.forEach(inputValue => {\r\n        defaultInputs.push(\r\n          inputValue.defaultInput !== null ? inputValue.defaultInput : \"\"\r\n        );\r\n      });\r\n    }\r\n    return defaultInputs;\r\n  };\r\n  /**\r\n   * If the operation requires input in addition to the layers, create corresponding\r\n   * fields for user input here\r\n   */\r\n  createInputFields = () => {\r\n    const { inputValues } = this.props.operation;\r\n    let inputFields = null;\r\n    if (inputValues) {\r\n      inputFields = [];\r\n      inputValues.forEach((inputValue, index) => {\r\n        inputFields.push(this.createInputField(inputValue, index));\r\n      });\r\n    }\r\n    return inputFields;\r\n  };\r\n  /**\r\n   * Create a single inputfield, either a checkbox or an inputfield\r\n   */\r\n  createInputField = (inputValue, index) => {\r\n    if (inputValue.inputType === InputTypes.boolean) {\r\n      return (\r\n        <div key={index}>\r\n          {inputValue.inputName}\r\n          <input\r\n            type={\"checkbox\"}\r\n            checked={this.state.inputs[index]}\r\n            onChange={() =>\r\n              this.setState(prevState => {\r\n                const inputs = prevState.inputs;\r\n                inputs.splice(index, 1, !inputs[index]);\r\n                return { inputs: inputs };\r\n              })\r\n            }\r\n          />\r\n        </div>\r\n      );\r\n    } else {\r\n      return (\r\n        <div key={index}>\r\n          {inputValue.inputName}\r\n          <input\r\n            type={\"text\"}\r\n            value={this.state.inputs[index]}\r\n            onChange={event => this.handleInputValue(event, index, inputValue)}\r\n          />\r\n        </div>\r\n      );\r\n    }\r\n  };\r\n  /**\r\n   * Validates if the user input is non-empty and of correct type.\r\n   * If not, replaces value with the default value, or an empty string if no default\r\n   */\r\n  handleInputValue = (event, index, inputValue) => {\r\n    const value = event.target.value;\r\n    this.setState(prevState => {\r\n      let newValue;\r\n      switch (inputValue.inputType) {\r\n        case InputTypes.number:\r\n          newValue = validateNumberInput(value, inputValue.defaultInput);\r\n          break;\r\n        case InputTypes.string:\r\n          newValue = String(value).length > 0 ? value : inputValue.defaultInput;\r\n          break;\r\n        default:\r\n          newValue = inputValue.defaultInput;\r\n      }\r\n      const inputs = prevState.inputs;\r\n      inputs.splice(index, 1, newValue);\r\n      return { inputs: inputs };\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Creates drag-drop fields for layers, by amount specified in operation\r\n   */\r\n  createLayerFields = () => {\r\n    const inputFields = [];\r\n    for (let i = 0; i < this.props.operation.inputLayers; i++) {\r\n      inputFields.push(\r\n        <ProcessingField\r\n          key={i}\r\n          index={i}\r\n          inputLayers={this.props.operation.inputLayers}\r\n          layer={this.state.layers[i]}\r\n          onSwap={this.handleSwap}\r\n          onDrop={this.handleDrop}\r\n        />\r\n      );\r\n    }\r\n    return inputFields;\r\n  };\r\n  /**\r\n   * Handles dropping of a layer. If it already exists, move the layer to the new position,\r\n   * and swap places if a layer is already there.\r\n   * If new layer, replace the layer currently on that index\r\n   * @param {Object} layer The dropped layer\r\n   * @param {Number} index The new index of the layer\r\n   */\r\n  handleDrop = (layer, index) => {\r\n    this.setState(prevState => {\r\n      const position = this.checkLayers(layer.id, prevState.layers);\r\n      let layers;\r\n      if (position > -1) {\r\n        layers = this.handleSwap(position, index, prevState.layers);\r\n      } else {\r\n        layers = prevState.layers;\r\n        layers.splice(index, 1, layer);\r\n      }\r\n      return { layers: layers };\r\n    });\r\n  };\r\n  /**\r\n   * If layer with id already exists, return index of the layer\r\n   */\r\n  checkLayers = (id, layers) => {\r\n    return layers.indexOf(\r\n      layers.find(layer => layer !== null && layer.id === id)\r\n    );\r\n  };\r\n  /**\r\n   * Swaps positions of two layers\r\n   */\r\n  handleSwap = (currentIndex, nextIndex, layers) => {\r\n    const layer = layers[currentIndex];\r\n    layers.splice(currentIndex, 1, layers[nextIndex]);\r\n    layers.splice(nextIndex, 1, layer);\r\n    return layers;\r\n  };\r\n\r\n  /**\r\n   * Resets state to default values. Empty for layers, default values for inputs\r\n   */\r\n  handleReset = () => {\r\n    this.setState(() => {\r\n      const defaultInputs = this.getDefaultValues(\r\n        this.props.operation.inputValues\r\n      );\r\n      return {\r\n        layers: new Array(this.props.operation.inputLayers).fill(null),\r\n        inputs: defaultInputs,\r\n        processing: false\r\n      };\r\n    });\r\n  };\r\n  /**\r\n   * Checks if processing can start.\r\n   * Can start if not already processing, if no layer fields are empty,\r\n   * and if all inputs are valid\r\n   */\r\n  processingStart = () => {\r\n    const { layers, inputs } = this.state;\r\n    const { operation } = this.props;\r\n    if (layers.find(layer => layer === null) === undefined) {\r\n      let canProcess = true;\r\n      if (operation.inputValues) {\r\n        operation.inputValues.forEach((inputValue, index) => {\r\n          //Input must be non-null, non-empty, and of correct type\r\n          if (\r\n            inputs[index] === null ||\r\n            String(inputs[index]).length === 0 ||\r\n            typeof inputs[index] !== inputValue.inputType\r\n          ) {\r\n            canProcess = false;\r\n          }\r\n        });\r\n      }\r\n      if (canProcess) {\r\n        this.props.popup\r\n          ? this.openPopup(layers, inputs)\r\n          : this.startProcessing(layers, inputs);\r\n      }\r\n    }\r\n  };\r\n  /**\r\n   * Starts processing without popup\r\n   */\r\n  startProcessing = (layers, inputs) => {\r\n    this.setState({\r\n      processing: true\r\n    });\r\n    const layer = this.props.operation.script(layers, inputs);\r\n    this.processFinished(layer);\r\n  };\r\n  /**\r\n   * Opens the popup processing window\r\n   */\r\n  openPopup = () => {\r\n    this.setState({\r\n      processing: true\r\n    });\r\n  };\r\n  /**\r\n   * Callback for when processing is done. Adds the layer to the map,\r\n   * and resets all inputs for the operation\r\n   */\r\n  processFinished = layer => {\r\n    if (layer !== null) {\r\n      this.props.onProcessingDone(layer);\r\n    } else {\r\n      alert(\"The processed area is empty\");\r\n    }\r\n    this.handleReset();\r\n  };\r\n  closePopup = () => {\r\n    this.setState({ processing: false });\r\n  };\r\n\r\n  /**\r\n   * Render function\r\n   * The popup is only created if this type of operation needs a seperate window\r\n   * Creates layer and inputfields based on operation specifications\r\n   * Creates reset button and start button for processing. Start button is greyed out if\r\n   * a process is ongoing.\r\n   */\r\n  render() {\r\n    const { listOpen, popup } = this.props;\r\n    const PopupComponent = popup ? this.props.operation.popupComponent : \"div\";\r\n    return (\r\n      <div className=\"template\">\r\n        <Popup\r\n          open={popup && this.state.processing}\r\n          modal\r\n          onClose={this.closePopup}\r\n        >\r\n          <PopupComponent\r\n            layers={this.state.layers}\r\n            inputs={this.state.inputs}\r\n            onExecute={this.processFinished}\r\n            onClose={this.closePopup}\r\n          />\r\n        </Popup>\r\n        <div onClick={() => this.props.onToggle(this.props.operation.name)}>\r\n          {this.props.operation.name}\r\n          {this.props.operation.info && (\r\n            <Popup\r\n              trigger={<img src={infoIcon} className=\"info-icon\" alt=\"\" />}\r\n              position=\"right top\"\r\n              on=\"hover\"\r\n            >\r\n              <img\r\n                style={{ width: \"300px\" }}\r\n                src={this.props.operation.info}\r\n                alt=\"\"\r\n              />\r\n            </Popup>\r\n          )}\r\n        </div>\r\n        {listOpen && (\r\n          <div>\r\n            {this.createLayerFields()}\r\n            {this.createInputFields()}\r\n            <button\r\n              onClick={() => this.handleReset()}\r\n              disabled={this.state.processing}\r\n            >\r\n              Clear\r\n            </button>\r\n            <button\r\n              onClick={() => this.processingStart()}\r\n              disabled={this.state.processing}\r\n            >\r\n              Start\r\n            </button>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nProcessingTemplate.propTypes = {\r\n  operation: PropTypes.shape(OperationShape).isRequired,\r\n  layer: PropTypes.shape(LayerShape),\r\n  onProcessingDone: PropTypes.func.isRequired,\r\n  onToggle: PropTypes.func.isRequired,\r\n  processing: PropTypes.bool\r\n};\r\n\r\nexport default ProcessingTemplate;\r\n","import React, { Component } from \"react\";\r\nimport { InputTypes } from \"../util/constants\";\r\nimport \"../css/sidebar.css\";\r\nimport deleteIcon from \"../../images/icondelete.svg\";\r\n\r\n/**\r\n * The ways property values can be compared when selecting data from layerfiles.\r\n */\r\nexport const ComparisonMethods = {\r\n  equal: \"is Equal to\",\r\n  notEqual: \"is not Equal to\",\r\n  greater: \"is Greater than\",\r\n  less: \"is Less than\",\r\n  greaterEqual: \"is Greater or Equal to\",\r\n  lessEqual: \"is Less or Equal to\"\r\n};\r\n/**\r\n * The datatypes in the three drop down menus\r\n */\r\nexport const AttributeType = {\r\n  property: \"property\",\r\n  operator: \"operator\",\r\n  value: \"value\"\r\n};\r\n/**\r\n * Class for selecting specific attributes from a layer and creating a new layer from them\r\n */\r\nclass AttributeSelector extends Component {\r\n  /**\r\n   * Datatypes:\r\n   * @param {Array} filters: Array of objects. Objects contain: property, operator, comparison value\r\n   * @param {Object} properties: Object with arrays. Keys are properties, values are array of property values\r\n   * @param {Map} datatypes: Map over the datatype each property contains\r\n   */\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      filters: [],\r\n      properties: {},\r\n      dataTypes: new Map(),\r\n      processing: false,\r\n      name: \"\"\r\n    };\r\n  }\r\n  /**\r\n   * Analyse values in the inputlayer, create an initial selectField\r\n   */\r\n  componentDidMount() {\r\n    this.loadAttributes();\r\n    this.addSelectField();\r\n  }\r\n  /**\r\n   * Go through each feature in the layer data, find all property types\r\n   * and add the property type and its possible values to a list.\r\n   */\r\n  loadAttributes = () => {\r\n    const layer = this.props.layers[0];\r\n    const properties = {};\r\n    for (let featureID in layer.data.features) {\r\n      const feature = layer.data.features[featureID];\r\n      for (let property in feature.properties) {\r\n        const newValue = feature.properties[property];\r\n        //Check if 'property' has been added before\r\n        if (property in properties) {\r\n          //Check if the new value has not been added before\r\n          if (properties[property].indexOf(newValue) === -1) {\r\n            properties[property].push(newValue);\r\n          }\r\n        }\r\n        //Initialize a list containing the possible values for 'property'\r\n        else {\r\n          properties[property] = [newValue];\r\n          this.setDataType(property, newValue);\r\n        }\r\n      }\r\n    }\r\n    this.setState({ properties: properties });\r\n  };\r\n  /**\r\n   * Set the datatype for each property. Can be string or number.\r\n   * Is used to determine which operators the user can use, ie: <, > may only be used on numbers\r\n   * @param {} property Property field from layer. Ex: \"road type\", \"water depth\".\r\n   * @param {} value Corresponding value of the property field. Ex: \"highway\", \"15\".\r\n   */\r\n  setDataType = (property, value) => {\r\n    let type = null;\r\n    if (!isNaN(value)) {\r\n      type = InputTypes.number;\r\n    } else {\r\n      type = InputTypes.string;\r\n    }\r\n    this.setState(prevState => {\r\n      return { dataTypes: prevState.dataTypes.set(property, type) };\r\n    });\r\n  };\r\n  /**\r\n   * Goes through the filters the user has chosen and creates a new layer based on them.\r\n   * If the user has entered a name, it is added to the new layer\r\n   */\r\n  onExecute = () => {\r\n    const layer = this.props.layers[0];\r\n    const data = Object.assign({}, layer.data);\r\n    data.features = [];\r\n    for (let featureID in layer.data.features) {\r\n      const feature = layer.data.features[featureID];\r\n      if (this.checkFilters(feature.properties)) {\r\n        data.features.push(feature);\r\n      }\r\n    }\r\n    let newName = this.state.name;\r\n    newName = newName.length > 0 ? newName : \"sp-\" + layer.name;\r\n    const extractedLayer = { name: newName, data: data };\r\n    this.props.onExecute(extractedLayer);\r\n  };\r\n  /**\r\n   * Check if the feature fulfills all selection criteria\r\n   */\r\n  checkFilters = properties => {\r\n    let fulfill = true;\r\n    for (let filterID in this.state.filters) {\r\n      const filter = this.state.filters[filterID];\r\n      if (!this.fulfillCriteria(filter, properties[filter.property])) {\r\n        fulfill = false;\r\n      }\r\n    }\r\n    return fulfill;\r\n  };\r\n  /**\r\n   * Compares the filter value to the inputvalue using the comparison method.\r\n   */\r\n  fulfillCriteria = (filter, value) => {\r\n    switch (filter.operator) {\r\n      case ComparisonMethods.equal:\r\n        return value === filter.value;\r\n      case ComparisonMethods.notEqual:\r\n        return value !== filter.value;\r\n      case ComparisonMethods.greater:\r\n        return value > filter.value;\r\n      case ComparisonMethods.less:\r\n        return value < filter.value;\r\n      case ComparisonMethods.greaterEqual:\r\n        return value >= filter.value;\r\n      case ComparisonMethods.lessEqual:\r\n        return value <= filter.value;\r\n      default:\r\n        return false;\r\n    }\r\n  };\r\n  /**\r\n   * Cancels the attribute selection without applying any filters\r\n   */\r\n  onCancel = () => {\r\n    this.props.onClose();\r\n  };\r\n  /**\r\n   * Add a new base selectfield to filters. Uses the first available property and its\r\n   * first legal operator and value\r\n   */\r\n  addSelectField = () => {\r\n    this.setState(prevState => {\r\n      const filters = prevState.filters;\r\n      const firstProperty = Object.keys(prevState.properties)[0];\r\n      const filter = this.getFilterForProperty(firstProperty, prevState);\r\n      filters.push(filter);\r\n      return { filters: filters };\r\n    });\r\n  };\r\n  /**\r\n   * Returns a valid filter for a specific property, with\r\n   * the first operator and value as its default values\r\n   */\r\n  getFilterForProperty = (property, prevState) => {\r\n    const filter = {\r\n      property: property,\r\n      operator: this.getLegalComparators(prevState.dataTypes.get(property))[0],\r\n      value: prevState.properties[property][0]\r\n    };\r\n    return filter;\r\n  };\r\n  /**\r\n   * Returns the comparators that can be used on a specific datatype.\r\n   * Strings can only have equals (=) and not equals (!=).\r\n   * Numbers can have all comparison methods\r\n   */\r\n  getLegalComparators = dataType => {\r\n    switch (dataType) {\r\n      case InputTypes.string:\r\n        return [ComparisonMethods.equal, ComparisonMethods.notEqual];\r\n      case InputTypes.number:\r\n        return Object.values(ComparisonMethods);\r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n  /**\r\n   * User deletes specific filter\r\n   */\r\n  deleteSelection = pos => {\r\n    this.setState(prevState => {\r\n      const filters = prevState.filters;\r\n      filters.splice(pos, 1);\r\n      return { filters: filters };\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Handles user input to a filter. Updates a filter object with the new\r\n   * value, according to which AttributeType is is\r\n   */\r\n  handleSelectionUpdate = (event, pos, type) => {\r\n    const newValue = event.target.value;\r\n    this.setState(prevState => {\r\n      const filters = prevState.filters;\r\n      let filter = filters[pos];\r\n      switch (type) {\r\n        //Need to update the property and its possible values\r\n        case AttributeType.property:\r\n          filter = this.getFilterForProperty(newValue, prevState);\r\n          break;\r\n        case AttributeType.operator:\r\n          filter.operator = newValue;\r\n          break;\r\n        case AttributeType.value:\r\n          filter.value = newValue;\r\n          break;\r\n        default:\r\n      }\r\n      filters.splice(pos, 1, filter);\r\n      return { filters: filters };\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Creates 3 drop down menus for filtering data from a layer.\r\n   * Menu for Attribute Property, Operator and Value,\r\n   * plus button for deleting the filter\r\n   */\r\n  createSelectFields = () => {\r\n    const selectFields = [];\r\n    const properties = Object.keys(this.state.properties);\r\n    this.state.filters.forEach((filter, position) => {\r\n      const comparators = this.getLegalComparators(\r\n        this.state.dataTypes.get(filter.property)\r\n      );\r\n      const values = this.state.properties[filter.property];\r\n      selectFields.push(\r\n        <div key={position}>\r\n          {this.createSelectField(\r\n            properties,\r\n            filter.property,\r\n            AttributeType.property,\r\n            position\r\n          )}\r\n          {this.createSelectField(\r\n            comparators,\r\n            filter.operator,\r\n            AttributeType.operator,\r\n            position\r\n          )}\r\n          {this.createSelectField(\r\n            values,\r\n            filter.value,\r\n            AttributeType.value,\r\n            position\r\n          )}\r\n          <img\r\n            src={deleteIcon}\r\n            alt=\"\"\r\n            onClick={() => this.deleteSelection(position)}\r\n          />\r\n        </div>\r\n      );\r\n    });\r\n    return selectFields;\r\n  };\r\n  /**\r\n   * Creates drop down menu with options from 'valueChoices'\r\n   */\r\n  createSelectField = (valueChoices, defaultChoice, type, pos) => {\r\n    return (\r\n      <select\r\n        key={type}\r\n        value={defaultChoice}\r\n        onChange={event => this.handleSelectionUpdate(event, pos, type)}\r\n      >\r\n        {valueChoices.map((value, index) => (\r\n          <option key={index} value={value}>\r\n            {value}\r\n          </option>\r\n        ))}\r\n      </select>\r\n    );\r\n  };\r\n  handleNameChange = event => {\r\n    const name = event.target.value;\r\n    this.setState({ name: name });\r\n  };\r\n\r\n  /**\r\n   * Render function\r\n   * Contains field for giving a name to the new layer\r\n   * Fields for filtering layer data\r\n   * Button for adding new filters\r\n   * Cancel button and start button\r\n   */\r\n  render() {\r\n    return (\r\n      <div>\r\n        <span>Name of new layer: </span>\r\n        <input\r\n          type={\"text\"}\r\n          value={this.state.name}\r\n          onChange={event => this.handleNameChange(event)}\r\n        />\r\n        <span>\r\n          <br />\r\n          Filters:\r\n        </span>\r\n        {this.createSelectFields()}\r\n        <button onClick={this.addSelectField} disabled={this.state.processing}>\r\n          Add filter\r\n        </button>\r\n        <button onClick={this.onCancel} disabled={this.state.processing}>\r\n          Cancel\r\n        </button>\r\n        <button\r\n          onClick={this.onExecute}\r\n          disabled={this.state.processing || this.state.filters.length === 0}\r\n        >\r\n          Start\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default AttributeSelector;\r\n","import { InputTypes } from \"../util/constants.js\";\r\nimport { bufferScript } from \"./buffer.js\";\r\nimport { intersectionScript } from \"./intersection.js\";\r\nimport { unionScript } from \"./union.js\";\r\nimport { differenceScript } from \"./difference\";\r\n\r\nimport bufferImg from \"../../images/buffer.png\";\r\nimport intersectionImg from \"../../images/intersection.png\";\r\nimport unionImg from \"../../images/union.png\";\r\nimport differenceImg from \"../../images/difference.png\";\r\n\r\nimport AttributeSelector from \"./attributeselector\";\r\n\r\n/**\r\n * Array of processing operators that do not need a special window for user input\r\n *\r\n * Format:\r\n * @param {String} name: Name of operation, must be unique\r\n * @param {Number} inputLayers: Inputlayers for the operation. Must be 1 or more\r\n * @param {Array|Null} inputValues: Which extra inputvalues the operation uses. Null if no extra input,\r\n * an array of objects describing the input is othervise\r\n * @param {Function} script: The js function which contains the operation\r\n * @param {Image|Null} info: A descriptive image of the operation. An image link or null if no image\r\n */\r\nexport const operations = [\r\n  {\r\n    name: \"Buffer\",\r\n    inputLayers: 1,\r\n    inputValues: [\r\n      createInputValue(\"Buffer radius\", 100, InputTypes.number),\r\n      createInputValue(\"Dissolve(slow)\", false, InputTypes.boolean)\r\n    ],\r\n    script: bufferScript,\r\n    info: bufferImg\r\n  },\r\n  {\r\n    name: \"Difference\",\r\n    inputLayers: 2,\r\n    inputValues: null,\r\n    script: differenceScript,\r\n    info: differenceImg\r\n  },\r\n  {\r\n    name: \"Intersection\",\r\n    inputLayers: 2,\r\n    inputValues: null,\r\n    script: intersectionScript,\r\n    info: intersectionImg\r\n  },\r\n  {\r\n    name: \"Union(very slow)\",\r\n    inputLayers: 2,\r\n    inputValues: null,\r\n    script: unionScript,\r\n    info: unionImg\r\n  }\r\n];\r\n/**\r\n * Creates objects describing inputvalue fields.\r\n * @param {String} inputName Name of inputvalue\r\n * @param {InputTypes} defaultInput Default value used as inputvalue\r\n * @param {InputTypes} inputType Type of inputvalue\r\n */\r\nfunction createInputValue(inputName, defaultInput, inputType) {\r\n  return {\r\n    inputName: inputName,\r\n    defaultInput: defaultInput,\r\n    inputType: inputType\r\n  };\r\n}\r\n\r\n/**\r\n * Operations needing additional user interaction, like feature extractors.\r\n * Must have a component describing the popupwindow\r\n *\r\n * Format:\r\n * @param {String} name: Name of operation, must be unique\r\n * @param {Number} inputLayers: Inputlayers for the operation. Must be 1 or more\r\n * @param {Array|Null} inputValues: Which extra inputvalues the operation uses. Null if no extra input,\r\n * an array of objects describing the input is othervise\r\n * @param {Function} popupComponent: The jsx component describing the popup window for the operation\r\n * @param {Image|Null} info: A descriptive image of the operation. An image link or null if no image\r\n */\r\nexport const componentOperations = [\r\n  {\r\n    name: \"Select properties\",\r\n    inputLayers: 1,\r\n    inputValues: null,\r\n    popupComponent: AttributeSelector,\r\n    info: null\r\n  }\r\n];\r\n","import { buffer, union } from \"@turf/turf\";\r\n/**\r\n * Adds a buffer around the input layer and returns the new buffered layer.\r\n * @param {Array} layers Array of layers. Contains 1 layer in this operation\r\n * @param {Array|Null} inputs Array of inputs. Containts 2 inputs in this operation\r\n */\r\nexport function bufferScript(layers, inputs) {\r\n  let resultLayer = null;\r\n  const layer = layers[0];\r\n  const bufferValue = inputs[0];\r\n  const shouldDissolve = inputs[1];\r\n  const name = layer.name + \"-buffer-\" + bufferValue + \"m\";\r\n\r\n  let bufferLayer = layer.data;\r\n  bufferLayer = buffer(bufferLayer, bufferValue, {\r\n    units: \"meters\"\r\n  });\r\n  //Take the union of all features in the layer and remove the previous properties,\r\n  //as the do not make sense with dissolved data\r\n  if (shouldDissolve) {\r\n    let dissolvedFeature = Object.assign({}, bufferLayer.features[0]);\r\n    for (let i = 1; i < bufferLayer.features.length; i++) {\r\n      dissolvedFeature = union(dissolvedFeature, bufferLayer.features[i]);\r\n    }\r\n    dissolvedFeature.properties = { geometryChanged: \"yes\" };\r\n    bufferLayer.features = [dissolvedFeature];\r\n  }\r\n\r\n  resultLayer = { name: name, data: bufferLayer };\r\n  return resultLayer;\r\n}\r\n","/**\r\n * Javacript class for finding difference between geojson layers\r\n * Takes two layers and show the area of the first layer, excluding the second layer\r\n */\r\n\r\nimport { difference, buffer } from \"@turf/turf\";\r\n/**\r\n * Takes two layers and returns the part of the first which does not overlap any part of the second\r\n * @param {Array} layers Array of layers. Contains 2 layers in this operation\r\n * @param {Array|Null} inputs Array of inputs. Null in this operation\r\n */\r\nexport function differenceScript(layers, inputs) {\r\n  const layer1 = layers[0];\r\n  const layer2 = layers[1];\r\n  const name = layer1.name + \"-difference-\" + layer2.name;\r\n  const resultLayer = { name: name };\r\n  const resultData = Object.assign({}, layer1.data);\r\n  resultData.features = [];\r\n  let buffer1 = buffer(layer1.data, 0.1, { units: \"meters\" });\r\n  let buffer2 = buffer(layer2.data, 0.1, { units: \"meters\" });\r\n  /**\r\n   * For each feature in layer1, take the difference from all features in layer2.\r\n   * If the result is not null we add the difference to a new layer\r\n   */\r\n  for (let i = 0; i < buffer1.features.length; i++) {\r\n    let nextFeature = Object.assign({}, buffer1.features[i]);\r\n    for (let j = 0; j < buffer2.features.length; j++) {\r\n      nextFeature = difference(nextFeature, buffer2.features[j]);\r\n      if (nextFeature === null) {\r\n        break;\r\n      }\r\n    }\r\n    if (nextFeature !== null) {\r\n      resultData.features.push(nextFeature);\r\n    }\r\n  }\r\n  if (!resultData.features[0]) {\r\n    return null;\r\n  }\r\n  resultLayer.data = resultData;\r\n  return resultLayer;\r\n}\r\n","import { intersect, buffer } from \"@turf/turf\";\r\n/**\r\n * Takes two layers and returns a new layer containing the intersection between them\r\n * @param {Array} layers Array of layers. Contains 2 layers in this operation\r\n * @param {Array|Null} inputs Array of inputs. Null in this operation\r\n */\r\nexport function intersectionScript(layers, inputs) {\r\n  const layer1 = layers[0];\r\n  const layer2 = layers[1];\r\n  const name = layer1.name + \"-intersect-\" + layer2.name;\r\n  const resultLayer = { name: name };\r\n  const resultData = Object.assign({}, layer1.data);\r\n  resultData.features = [];\r\n  //Perform buffer operation to transform data to polygons\r\n  let buffer1 = buffer(layer1.data, 0.1, { units: \"meters\" });\r\n  let buffer2 = buffer(layer2.data, 0.1, { units: \"meters\" });\r\n  /**\r\n   * For each feature in both layers, checks the overlapping area and\r\n   * adds is to a new layer\r\n   */\r\n  for (let i = 0; i < buffer1.features.length; i++) {\r\n    const feature1 = buffer1.features[i];\r\n    for (let j = 0; j < buffer2.features.length; j++) {\r\n      const feature2 = buffer2.features[j];\r\n      const intersectPolygon = intersect(feature1, feature2);\r\n      if (intersectPolygon !== null) {\r\n        resultData.features.push(intersectPolygon);\r\n      }\r\n    }\r\n  }\r\n  if (!resultData.features[0]) {\r\n    return null;\r\n  }\r\n  resultLayer.data = resultData;\r\n  return resultLayer;\r\n}\r\n","/**\r\n * Javacript class for finding intersection between geojson layers\r\n * Takes two layers and returns layer containing intersection\r\n * First input is array of layers\r\n */\r\n\r\nimport { union, buffer } from \"@turf/turf\";\r\n/**\r\n * Takes two layers and merges them\r\n * @param {Array} layers Array of layers. Contains 2 layers in this operation\r\n * @param {Array|Null} inputs Array of inputs. Null in this operation\r\n */\r\nexport function unionScript(layers, inputs) {\r\n  let resultLayer = null;\r\n  const layer1 = layers[0];\r\n  const layer2 = layers[1];\r\n  const name = layer1.name + \"-union-\" + layer2.name;\r\n  let buffer1 = buffer(layer1.data, 0.1, { units: \"meters\" });\r\n  let buffer2 = buffer(layer2.data, 0.1, { units: \"meters\" });\r\n  //Merge all features in layer1\r\n  let feature1 = Object.assign({}, buffer1.features[0]);\r\n  for (let i = 1; i < buffer1.features.length; i++) {\r\n    feature1 = union(feature1, buffer1.features[i]);\r\n  }\r\n  //Merge all features in layer2\r\n  let feature2 = Object.assign({}, buffer2.features[0]);\r\n  for (let i = 1; i < buffer2.features.length; i++) {\r\n    feature2 = union(feature2, buffer2.features[i]);\r\n  }\r\n  //Return the union of the two merged layers\r\n  const unionLayer = union(feature1, feature2);\r\n  resultLayer = { name: name, data: unionLayer };\r\n  return resultLayer;\r\n}\r\n","import React, { Component } from \"react\";\r\nimport { DragDropContext } from \"react-dnd\";\r\nimport HTML5Backend from \"react-dnd-html5-backend\";\r\nimport SideBar from \"./components/sidebar\";\r\nimport LeafletMap from \"./components/leafletmap\";\r\nimport { getInfo, getColor } from \"./components/util/support.js\";\r\nimport { LayerShape } from \"./components/util/constants.js\";\r\nimport PropTypes from \"prop-types\";\r\nimport \"./App.css\";\r\n\r\nconst DB_NAME = \"gisdb\";\r\nconst LAYER_STORE = \"layers\";\r\n//const GROUP_STORE = \"groups\";\r\nconst DB_VERSION = 1;\r\nvar db;\r\n\r\n/**\r\n * Controller class for website. Responsible for creating all components\r\n * and contains current system state\r\n */\r\nclass App extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      layers: [],\r\n      visibility: new Map(),\r\n      styles: new Map()\r\n    };\r\n    this.leafletmap = React.createRef();\r\n  }\r\n  /**\r\n   * Initialize database, retrieve locally saved layers\r\n   */\r\n  componentDidMount() {\r\n    this.dbInit();\r\n  }\r\n  /**\r\n   * Close database connection\r\n   */\r\n  componentWillUnmount() {\r\n    db.close();\r\n  }\r\n  /**\r\n   * Initialize database if not created, and reads saved layers\r\n   */\r\n  dbInit = () => {\r\n    let request = indexedDB.open(DB_NAME, DB_VERSION);\r\n    request.onerror = event => {\r\n      alert(\"Error with indexeddb\");\r\n    };\r\n    //Database is not created, create new\r\n    request.onupgradeneeded = event => {\r\n      request.result.createObjectStore(LAYER_STORE, {\r\n        keyPath: \"id\",\r\n        autoIncrement: true\r\n      });\r\n    };\r\n    request.onsuccess = event => {\r\n      db = request.result;\r\n      this.loadLayers();\r\n    };\r\n  };\r\n  /**\r\n   * Load layers from indexeddb and insert into state\r\n   */\r\n  loadLayers = () => {\r\n    let dbload = db.transaction(LAYER_STORE, \"readonly\");\r\n    let objstore = dbload.objectStore(LAYER_STORE);\r\n\r\n    let request = objstore.getAll();\r\n    request.onsuccess = event => {\r\n      this.addGeoJSONLayer(event.target.result);\r\n    };\r\n  };\r\n  /**\r\n   * Handles uploaded and converted geojson files.\r\n   * Reads content and saves if not empty\r\n   * @param {File} file, geojson file to be read and saved\r\n   */\r\n  handleUpload = files => {\r\n    files.forEach(file => {\r\n      let json = null;\r\n      let reader = new FileReader();\r\n      reader.onload = () => {\r\n        try {\r\n          let datatext = reader.result;\r\n          json = JSON.parse(datatext);\r\n          if (json !== null) {\r\n            let layer = {\r\n              name: file.name.toLowerCase().replace(\".geojson\", \"\"),\r\n              data: json\r\n            };\r\n            this.localSave(layer);\r\n          }\r\n        } catch (ex) {\r\n          alert(\"Error reading json file: \" + ex);\r\n          return;\r\n        }\r\n      };\r\n      reader.readAsText(file);\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Saves file locally, then calls createFromGeoJSON\r\n   * @param {Object} layer Object with processed json data and name\r\n   */\r\n  localSave = layer => {\r\n    let dbsave = db.transaction(LAYER_STORE, \"readwrite\");\r\n    let objstore = dbsave.objectStore(LAYER_STORE);\r\n    let request;\r\n    request = objstore.put(layer);\r\n    request.onsuccess = event => {\r\n      if (layer.id === undefined) {\r\n        layer.id = event.target.result;\r\n        this.addGeoJSONLayer([layer]);\r\n      }\r\n    };\r\n  };\r\n  /**\r\n   * Creates sidebar layer and map layer\r\n   * @param {Layer} layer Layer with name, data and id\r\n   */\r\n  addGeoJSONLayer = layers => {\r\n    layers.forEach(layer => {\r\n      console.log(layer);\r\n      this.setState(prevState => {\r\n        const layers = prevState.layers;\r\n        layers.splice(0, 0, layer);\r\n        let style = prevState.styles.get(layer.id)\r\n          ? prevState.styles.get(layer.id)\r\n          : this.setStyle(layer.id);\r\n        return {\r\n          layers: layers,\r\n          visibility: prevState.visibility.set(layer.id, true),\r\n          styles: prevState.styles.set(layer.id, style)\r\n        };\r\n      });\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Set default style for a layer\r\n   */\r\n  setStyle = id => {\r\n    const opacity = 0.8;\r\n    const color = getColor(id);\r\n    const style = { color: color, opacity: opacity };\r\n    return style;\r\n  };\r\n\r\n  /**\r\n   * Delete layer from storage, sidebar and map\r\n   */\r\n  handleDelete = id => {\r\n    this.deleteFromStorage(id);\r\n    this.deleteFromState(id);\r\n    this.deleteFromLeaflet(id);\r\n  };\r\n  /**\r\n   * Zoom in on one layer\r\n   */\r\n  handleZoom = id => {\r\n    this.leafletmap.current.zoomToLayer(id);\r\n  };\r\n  /**\r\n   * Change name of layer, in both current state and in local storage\r\n   */\r\n  handleNameChange = (layer, name) => {\r\n    if (layer.name !== name && name.length > 0) {\r\n      layer.name = name;\r\n      this.localSave(layer);\r\n    }\r\n  };\r\n  /**\r\n   * Change the layer style (color, opacity) if the changes are not null\r\n   */\r\n  handleStyleChange = (id, style) => {\r\n    this.setState(prevState => {\r\n      let { color, opacity } = style;\r\n      const prevStyle = prevState.styles.get(id);\r\n      color = color !== null ? color : prevStyle.color;\r\n      opacity = opacity !== null ? opacity : prevStyle.opacity;\r\n      return {\r\n        styles: prevState.styles.set(id, {\r\n          color: color,\r\n          opacity: opacity\r\n        })\r\n      };\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Delete layer from indexeddb\r\n   */\r\n  deleteFromStorage = id => {\r\n    let dbdelete = db.transaction(LAYER_STORE, \"readwrite\");\r\n    let objstore = dbdelete.objectStore(LAYER_STORE);\r\n    let request = objstore.delete(id);\r\n    request.onsuccess = event => {\r\n      //console.log(\"Deleted \" + id);\r\n    };\r\n  };\r\n  /**\r\n   * Delete layer from state, which in turn deletes it from the sidebar\r\n   */\r\n  deleteFromState = id => {\r\n    this.setState(prevState => {\r\n      const layers = prevState.layers.filter(l => l.id !== id);\r\n      return { layers: layers };\r\n    });\r\n  };\r\n  /**\r\n   * Delete layer from leaflet\r\n   */\r\n  deleteFromLeaflet = id => {\r\n    this.leafletmap.current.removeLayer(id);\r\n  };\r\n  /**\r\n   * There are some error with the layer, ex: invalid geoJSON, it should be deleted\r\n   */\r\n  handleError = id => {\r\n    this.handleDelete(id);\r\n  };\r\n  /**\r\n   * A layer is dragged to a new position, reorder the layers\r\n   */\r\n  handleMove = (id, newIndex) => {\r\n    this.setState(prevState => {\r\n      const layerInfo = getInfo(id, prevState.layers);\r\n      const layers = prevState.layers;\r\n      layers.splice(layerInfo.index, 1);\r\n      layers.splice(newIndex, 0, layerInfo.info);\r\n      return { layers: layers };\r\n    });\r\n  };\r\n  /**\r\n   * Gets a new layer as a result of a processing operation. Saves it locally\r\n   */\r\n  handleProcessing = layer => {\r\n    this.localSave(layer);\r\n  };\r\n  /**\r\n   * The visibility of a layer is toggled\r\n   */\r\n  handleToggle = id => {\r\n    this.setState(prevState => {\r\n      return {\r\n        visibility: prevState.visibility.set(id, !prevState.visibility.get(id))\r\n      };\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Render function.\r\n   * Contains Sidebar\r\n   * LeafletMap\r\n   */\r\n  render() {\r\n    return (\r\n      <React.Fragment>\r\n        <SideBar\r\n          layerlist={this.state.layers}\r\n          visiblemap={this.state.visibility}\r\n          stylemap={this.state.styles}\r\n          onUpload={this.handleUpload}\r\n          onDelete={this.handleDelete}\r\n          onToggle={this.handleToggle}\r\n          onMove={this.handleMove}\r\n          onZoom={this.handleZoom}\r\n          onNameChange={this.handleNameChange}\r\n          onStyleChange={this.handleStyleChange}\r\n          onProcessingDone={this.handleProcessing}\r\n        />\r\n        <LeafletMap\r\n          ref={this.leafletmap}\r\n          layerlist={this.state.layers}\r\n          visiblemap={this.state.visibility}\r\n          stylemap={this.state.styles}\r\n          onError={this.handleError}\r\n        />\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nApp.propTypes = {\r\n  layers: PropTypes.arrayOf(PropTypes.shape(LayerShape)),\r\n  layer: PropTypes.shape(LayerShape),\r\n  visibility: PropTypes.instanceOf(Map),\r\n  id: PropTypes.number,\r\n  newIndex: PropTypes.number,\r\n  DB_NAME: PropTypes.string,\r\n  LAYER_STORE: PropTypes.string,\r\n  DB_VERSION: PropTypes.number\r\n};\r\n\r\nexport default DragDropContext(HTML5Backend)(App);\r\n","import React, { Component } from \"react\";\r\nimport \"./css/sidebar.css\";\r\nimport PropTypes from \"prop-types\";\r\nimport { OperationShape } from \"./util/constants.js\";\r\nimport ProcessingTemplate from \"./processingtemplate\";\r\nimport {\r\n  operations,\r\n  componentOperations\r\n} from \"./processing/operationtypes.js\";\r\n\r\n/**\r\n * Class for listing all operations, and managing their output\r\n */\r\nclass Geoprocessing extends Component {\r\n  state = {\r\n    operations: operations,\r\n    componentOperations: componentOperations,\r\n    listOpen: null\r\n  };\r\n  /**\r\n   * Toggles which operation is expanded. Only one may be expanded at any time\r\n   */\r\n  handleToggle = name => {\r\n    this.setState(prevState => {\r\n      if (prevState.listOpen === name) {\r\n        return { listOpen: null };\r\n      } else {\r\n        return { listOpen: name };\r\n      }\r\n    });\r\n  };\r\n  /**\r\n   * Create clickable sidebar entity for each operation\r\n   * @param {Object} operation The object describing the operation\r\n   * @param {Boolean} popup If the operation is a whole component, or only a function\r\n   */\r\n  createProcessingTemplate = (operation, popup) => {\r\n    return (\r\n      <ProcessingTemplate\r\n        key={operation.name}\r\n        operation={operation}\r\n        onToggle={this.handleToggle}\r\n        onProcessingDone={this.props.onProcessingDone}\r\n        listOpen={this.state.listOpen === operation.name}\r\n        popup={popup}\r\n      />\r\n    );\r\n  };\r\n  render() {\r\n    return (\r\n      <div>\r\n        <div className=\"group-divider\">Geoprocessing</div>\r\n        {this.state.componentOperations.map(operation =>\r\n          this.createProcessingTemplate(operation, true)\r\n        )}\r\n        {this.state.operations.map(operation =>\r\n          this.createProcessingTemplate(operation, false)\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nGeoprocessing.propTypes = {\r\n  operations: PropTypes.arrayOf(PropTypes.shape(OperationShape)),\r\n  onProcessingDone: PropTypes.func.isRequired\r\n};\r\n\r\nexport default Geoprocessing;\r\n","import React, { Component } from \"react\";\r\nimport Dropzone from \"react-dropzone\";\r\nimport \"./css/sidebar.css\";\r\nimport { ACCEPTED_FILE_TYPES, SHAPE_FORMATS } from \"./util/constants.js\";\r\nimport PropTypes from \"prop-types\";\r\n\r\n/**\r\n * Class for the upload button. Can upload geoJSON files\r\n */\r\nclass Upload extends Component {\r\n  /**\r\n   * Checks file type and chooses convertion function.\r\n   * Can convert geoJSON, possibility for adding GML and Shape later\r\n   * @param files, all input files from user\r\n   */\r\n  handleUpload = files => {\r\n    let shapeFiles = [];\r\n    let gmlFiles = [];\r\n    let geoJsonFiles = [];\r\n    files.forEach(file => {\r\n      let filename = file.name.toLowerCase();\r\n      if (filename.length > 0) {\r\n        if (filename.endsWith(\".geojson\")) {\r\n          geoJsonFiles.push(file);\r\n        } else if (filename.endsWith(\".gml\")) {\r\n          gmlFiles.push(file);\r\n        } else if (\r\n          SHAPE_FORMATS.filter(format => filename.endsWith(format)).length > 0\r\n        ) {\r\n          shapeFiles.push(file);\r\n        } else {\r\n          alert(\"Not valid filetype: \" + filename);\r\n        }\r\n      }\r\n    });\r\n    this.props.onUpload(geoJsonFiles);\r\n  };\r\n\r\n  /**\r\n   * Render function\r\n   * Contains a dropzone. Can either be clicked to open field upload dialogue,\r\n   * or can drop files over\r\n   */\r\n  render() {\r\n    return (\r\n      <div>\r\n        <Dropzone\r\n          className=\"drop-zone\"\r\n          accept={ACCEPTED_FILE_TYPES}\r\n          onDrop={files => {\r\n            this.handleUpload(files);\r\n          }}\r\n        >\r\n          <div>\r\n            Click to upload files. Only geojson files\r\n            {/*, gml and shapefiles*/} can be uploaded\r\n          </div>\r\n        </Dropzone>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nUpload.propTypes = {\r\n  onUpload: PropTypes.func.isRequired,\r\n  gmlFiles: PropTypes.array,\r\n  shapeFiles: PropTypes.array,\r\n  geoJsonFiles: PropTypes.array,\r\n  ACCEPTED_FILE_TYPES: PropTypes.string,\r\n  SHAPE_FORMATS: PropTypes.array\r\n};\r\n\r\nexport default Upload;\r\n","import React, { Component } from \"react\";\r\nimport LayerList from \"./layerlist\";\r\nimport Geoprocessing from \"./geoprocessing\";\r\nimport Upload from \"./upload\";\r\nimport \"./css/sidebar.css\";\r\nimport PropTypes from \"prop-types\";\r\nimport { LayerShape } from \"./util/constants\";\r\n\r\n/**\r\n * Class the sidebar. Contains the layers, the operations and the upload file button\r\n */\r\nclass SideBar extends Component {\r\n  /**\r\n   * Render function.\r\n   * Contains list of processing functions\r\n   * List of layers\r\n   * Area for uploading files\r\n   */\r\n  render() {\r\n    return (\r\n      <nav id=\"sidebar\" className=\"navbar bg-light\">\r\n        <Geoprocessing onProcessingDone={this.props.onProcessingDone} />\r\n        <LayerList\r\n          layerlist={this.props.layerlist}\r\n          visiblemap={this.props.visiblemap}\r\n          stylemap={this.props.stylemap}\r\n          onDelete={this.props.onDelete}\r\n          onToggle={this.props.onToggle}\r\n          onMove={this.props.onMove}\r\n          onZoom={this.props.onZoom}\r\n          onNameChange={this.props.onNameChange}\r\n          onStyleChange={this.props.onStyleChange}\r\n        />\r\n        <Upload onUpload={this.props.onUpload} />\r\n      </nav>\r\n    );\r\n  }\r\n}\r\n\r\nSideBar.propTypes = {\r\n  layerlist: PropTypes.arrayOf(PropTypes.shape(LayerShape)),\r\n  visiblemap: PropTypes.instanceOf(Map).isRequired,\r\n  onMove: PropTypes.func.isRequired,\r\n  onUpload: PropTypes.func.isRequired\r\n};\r\n\r\nexport default SideBar;\r\n","import React, { Component } from \"react\";\r\nimport L from \"leaflet\";\r\nimport \"leaflet/dist/leaflet.css\";\r\nimport \"./css/map.css\";\r\nimport PropTypes from \"prop-types\";\r\nimport { LayerShape } from \"./util/constants.js\";\r\n\r\n/**\r\n * Class for all interactions with the leaflet map\r\n */\r\nclass LeafletMap extends Component {\r\n  state = {\r\n    mapid: \"mapid\",\r\n    center: [63.42, 10.55],\r\n    zoom: 12\r\n  };\r\n\r\n  /**\r\n   * Instantiates the map and the featuregroup containing all layers\r\n   */\r\n  componentDidMount() {\r\n    this.map = this.createMap(this.state.mapid);\r\n    this.featuregroup = L.featureGroup();\r\n    this.featuregroup.addTo(this.map);\r\n  }\r\n  /**\r\n   * Leaflet map constructor with Kartverket basemap\r\n   * @param mapid, id of <div> the map will be placed in\r\n   */\r\n  createMap(mapid) {\r\n    let map = L.map(mapid).setView(this.state.center, this.state.zoom);\r\n    L.tileLayer(\r\n      \"http://opencache.statkart.no/gatekeeper/gk/gk.open_gmaps?layers=norges_grunnkart&zoom={z}&x={x}&y={y}\",\r\n      {\r\n        attribution: '<a href=\"http://www.kartverket.no/\">Kartverket</a>'\r\n      }\r\n    ).addTo(map);\r\n    map.zoomControl.setPosition(\"topright\");\r\n\r\n    return map;\r\n  }\r\n  /**\r\n   * When props are updated:\r\n   * Goes through each layer, checks the visibility settings,\r\n   * adds layers and pushes them to the back, starting with the front layers\r\n   */\r\n  componentDidUpdate() {\r\n    this.props.layerlist.forEach(layer => {\r\n      //Layer is visible, add and bring to back\r\n      if (this.props.visiblemap.get(layer.id)) {\r\n        let leaflayer = this.addLayer(layer);\r\n        let style = this.props.stylemap.get(layer.id);\r\n        leaflayer.setStyle({ color: style.color, opacity: style.opacity });\r\n        leaflayer.bringToBack();\r\n      }\r\n      //Layer is not visible, remove\r\n      else {\r\n        this.removeLayer(layer.id);\r\n      }\r\n    });\r\n  }\r\n\r\n  zoomToLayer = id => {\r\n    const layer = this.getLayerById(id);\r\n    this.map.fitBounds(layer.getBounds());\r\n  };\r\n  /**\r\n   * Inserts data as geojson layer. Adds id field for easier identification.\r\n   * If leaflet cannot read the layer, delete it from storage\r\n   * @param {*} layer\r\n   */\r\n  addLayer = layer => {\r\n    let leaflayer = this.getLayerById(layer.id);\r\n    if (leaflayer === undefined) {\r\n      try {\r\n        leaflayer = L.geoJSON(layer.data);\r\n        leaflayer.id = layer.id;\r\n        this.featuregroup.addLayer(leaflayer);\r\n      } catch (e) {\r\n        this.props.onError(layer.id);\r\n      }\r\n    }\r\n    return leaflayer;\r\n  };\r\n  /**\r\n   * Finds and removes layer in feature group with id matching input id\r\n   * @param {*} id\r\n   */\r\n  removeLayer = id => {\r\n    const layer = this.getLayerById(id);\r\n    if (layer !== undefined) {\r\n      this.featuregroup.removeLayer(layer);\r\n    }\r\n  };\r\n  getLayerById = id => {\r\n    return this.featuregroup.getLayers().find(layer => layer.id === id);\r\n  };\r\n  render() {\r\n    return <div id={this.state.mapid} />;\r\n  }\r\n}\r\n\r\nLeafletMap.propTypes = {\r\n  layerlist: PropTypes.arrayOf(PropTypes.shape(LayerShape)),\r\n  visiblemap: PropTypes.instanceOf(Map).isRequired,\r\n  layer: PropTypes.shape(LayerShape),\r\n  map: PropTypes.object\r\n};\r\n\r\nexport default LeafletMap;\r\n","// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport default function register() {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Lets check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://goo.gl/SC7cgQ'\n          );\n        });\n      } else {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the old content will have been purged and\n              // the fresh content will have been added to the cache.\n              // It's the perfect time to display a \"New content is\n              // available; please refresh.\" message in your web app.\n              console.log('New content is available; please refresh.');\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get('content-type').indexOf('javascript') === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import \"bootstrap/dist/css/bootstrap.min.css\";\r\nimport React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport \"./index.css\";\r\nimport App from \"./App\";\r\n\r\nimport registerServiceWorker from \"./registerServiceWorker\";\r\n\r\nReactDOM.render(<App />, document.getElementById(\"root\"));\r\nregisterServiceWorker();\r\n","module.exports = __webpack_public_path__ + \"static/media/icondelete.d36bd4a7.svg\";","module.exports = __webpack_public_path__ + \"static/media/iconzoom.c135a649.svg\";","module.exports = __webpack_public_path__ + \"static/media/iconsettings.674d9d35.svg\";","module.exports = __webpack_public_path__ + \"static/media/iconinfo.7d03c90c.svg\";","module.exports = __webpack_public_path__ + \"static/media/buffer.72eaeea6.png\";","module.exports = __webpack_public_path__ + \"static/media/intersection.9866121b.png\";","module.exports = __webpack_public_path__ + \"static/media/union.2f066b4c.png\";","module.exports = __webpack_public_path__ + \"static/media/difference.679a0c19.png\";"],"sourceRoot":""}