(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{102:function(e,t,n){},11:function(e,t,n){},228:function(e,t,n){},241:function(e,t,n){},245:function(e,t,n){},247:function(e,t,n){},249:function(e,t,n){"use strict";n.r(t);n(96);var a=n(0),r=n.n(a),o=n(35),i=n.n(o),s=(n(102),n(2)),l=n(3),u=n(5),c=n(4),p=n(6),d=n(12),f=n(85),g=n.n(f),h=n(1),m=n.n(h),y=[".shp",".dbf",".prj",".sbn",".sbx",".shx",".shp.xml"],v="layer",b="operation",O=(m.a.number.isRequired,m.a.string.isRequired,m.a.object.isRequired,m.a.string.isRequired,m.a.number.isRequired,{number:"number",boolean:"boolean",string:"string"}),E=(n(11),n(228),n(54),n(36)),j=n.n(E),S=n(19),C=n(86),k=n.n(C),D=n(87),x=n.n(D),w=n(37),I=n.n(w),L={delete:"delete",zoom:"zoom",properties:"properties"};var T=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(o)))).handleClick=function(e){e===L.delete?n.props.onDelete(n.props.layer.id):e===L.zoom?n.props.onZoom(n.props.layer.id):e===L.properties&&n.props.openPopup(n.props.layer)},n.createContexMenu=function(){return r.a.createElement("div",null,r.a.createElement(S.a,{id:n.props.index.toString()},n.createContexMenuItem(L.properties,"Properties",x.a),r.a.createElement(S.c,{divider:!0}),n.createContexMenuItem(L.zoom,"Zoom to layer",k.a),r.a.createElement(S.c,{divider:!0}),n.createContexMenuItem(L.delete,"Delete layer",I.a)))},n.createContexMenuItem=function(e,t,a){return r.a.createElement(S.c,{onClick:function(){return n.handleClick(e)}},t,r.a.createElement("img",{src:a,className:"icon",alt:""}))},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.isDragging,a=t.isOver;return(0,t.connectDragSource)((0,t.connectDropTarget)(r.a.createElement("div",{className:"layer",style:{opacity:n?0:1,backgroundColor:a?"rgb(120, 120, 120)":"rgb(217, 217, 217)"}},r.a.createElement(S.b,{id:this.props.index.toString(),holdToDisplay:-1},r.a.createElement("span",null,this.props.layer.name),r.a.createElement("div",{style:{height:"20px",width:"20px",float:"left",backgroundColor:this.props.style.color}}),r.a.createElement("input",{type:"checkbox",style:{float:"right"},checked:this.props.visible,onChange:function(){return e.props.onToggle(e.props.layer.id)}})),this.createContexMenu())))}}]),t}(a.Component),N=j()(Object(d.DragSource)(v,{beginDrag:function(e){return{draggedId:e.layer.id,draggedIndex:e.index,draggedName:e.layer.name,draggedData:e.layer.data}}},function(e,t){return{connectDragSource:e.dragSource(),isDragging:t.isDragging()}}),Object(d.DropTarget)(v,{canDrop:function(e,t){return t.getItem().draggedId!==e.layer.id},drop:function(e,t){if(!t.didDrop()){var n=t.getItem().draggedId;e.onMove(n,e.index)}}},function(e,t){return{connectDropTarget:e.dropTarget(),isOver:t.isOver()}}))(T);function P(e,t){if(0===e.length)return"";for(var n="",a=0;a<e.length;a++){var r=e.charAt(a);isNaN(Number(r))||(n+=r)}return n.length>0?Number(n):null!==t?t:""}var F={name:"Name: ",color:"Color: ",opacity:"Opacity: "},M=function(e){function t(e){var n;Object(s.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this,e))).handleTextInput=function(e,t,a){var r=e.target.value;n.setState(function(e){return{inputs:e.inputs.set(t,r)}})},n.handleRangeInput=function(e,t,a,r,o){var i=P(e.target.value,a);i=String(i).length>0?n.ValidateRangeInput(i/100,a,r,o):"",n.setState(function(e){return{inputs:e.inputs.set(t,i)}})},n.ValidateRangeInput=function(e,t,n,a){return Number(e)<n?e=n:Number(e)>a&&(e=a),e},n.applyChanges=function(){n.props.onNameChange(n.props.layer,n.state.inputs.get(F.name));var e=n.state.inputs.get(F.color),t=n.state.inputs.get(F.opacity);n.props.onStyleChange(n.props.layer.id,{color:e.length>0?e:null,opacity:String(t).length>0?t:null}),n.removeDialogue()},n.removeDialogue=function(){n.props.onDialogueFinished()},n.createPage=function(){return r.a.createElement(r.a.Fragment,null,n.textInput(F.name,n.state.inputs.get(F.name),n.handleTextInput),n.colorInput(F.color,n.state.inputs.get(F.color),n.handleTextInput),n.rangeInput(F.opacity,String(n.state.inputs.get(F.opacity)).length>0?100*n.state.inputs.get(F.opacity):"",0,1,n.handleRangeInput),r.a.createElement("button",{onClick:n.removeDialogue},"Cancel"),r.a.createElement("button",{onClick:n.applyChanges},"Apply"))},n.textInput=function(e,t,n){return r.a.createElement("div",null,e,r.a.createElement("input",{type:"text",value:t,onChange:function(a){return n(a,e,t)}}))},n.rangeInput=function(e,t,n,a,o){return r.a.createElement("div",null,e,r.a.createElement("input",{type:"text",style:{width:"50px"},value:t,onChange:function(r){return o(r,e,t,n,a)}}),"%")},n.colorInput=function(e,t,n){return r.a.createElement("div",null,e,r.a.createElement("input",{type:"color",value:t,onChange:function(a){return n(a,e,t)}}))};var a=new Map([[F.name,e.layer.name],[F.color,e.style.color],[F.opacity,e.style.opacity]]);return n.state={inputs:a},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"properties-menu"},"Layer properties",this.createPage())}}]),t}(a.Component),q=n(23),V=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this,e))).openPopup=function(e){n.setState({openPopup:!0,layer:e,style:n.props.stylemap.get(e.id)})},n.closePopup=function(){n.setState({openPopup:!1,layer:null,style:null})},n.state={openPopup:!1,layer:null,style:null},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("div",{className:"group-divider"},"Layers"),r.a.createElement(q.a,{open:this.state.openPopup,modal:!0,onClose:this.closePopup},r.a.createElement(M,{layer:this.state.layer,style:this.state.style,onNameChange:this.props.onNameChange,onStyleChange:this.props.onStyleChange,onDialogueFinished:this.closePopup})),this.props.layerlist.map(function(t,n){return r.a.createElement(N,{key:t.id,index:n,layer:t,visible:e.props.visiblemap.get(t.id),style:e.props.stylemap.get(t.id),onDelete:e.props.onDelete,onToggle:e.props.onToggle,onMove:e.props.onMove,onZoom:e.props.onZoom,openPopup:e.openPopup})}))}}]),t}(a.Component);var R=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.isDragging,n=e.isOver,a=e.connectDragSource,o=e.connectDropTarget,i=null!==this.props.layer,s=i&&this.props.inputLayers>1;return a(o(r.a.createElement("div",{className:"processing-field",style:{opacity:t?0:n?.8:1,border:i?"2px solid black":"2px dotted black",cursor:s?"pointer":"default"}},!i&&"Drop layer "+(this.props.index+1)+" here"||i&&this.props.layer.name)))}}]),t}(a.Component),A=j()(Object(d.DragSource)(b,{beginDrag:function(e){return{draggedId:e.layer.id,draggedName:e.layer.name,draggedData:e.layer.data}},canDrag:function(e){return e.inputLayers>1&&null!==e.layer}},function(e,t){return{connectDragSource:e.dragSource(),isDragging:t.isDragging()}}),Object(d.DropTarget)([v,b],{canDrop:function(e,t){if(null===e.layer)return!0;var n=t.getItem().draggedId;return e.layer.id!==n},drop:function(e,t){if(!t.didDrop()){var n=t.getItem(),a={id:n.draggedId,name:n.draggedName,data:n.draggedData};e.onDrop(a,e.index)}}},function(e,t){return{connectDropTarget:e.dropTarget(),isOver:t.isOver()}}))(R),U=n(88),z=n.n(U),B=function(e){function t(e){var n;Object(s.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this,e))).getDefaultValues=function(e){var t=null;return e&&(t=[],e.forEach(function(e){t.push(null!==e.defaultInput?e.defaultInput:"")})),t},n.createInputFields=function(){var e=n.props.operation.inputValues,t=null;return e&&(t=[],e.forEach(function(e,a){t.push(n.createInputField(e,a))})),t},n.createInputField=function(e,t){return e.inputType===O.boolean?r.a.createElement("div",{key:t},e.inputName,r.a.createElement("input",{type:"checkbox",checked:n.state.inputs[t],onChange:function(){return n.setState(function(e){var n=e.inputs;return n.splice(t,1,!n[t]),{inputs:n}})}})):r.a.createElement("div",{key:t},e.inputName,r.a.createElement("input",{type:"text",value:n.state.inputs[t],onChange:function(a){return n.handleInputValue(a,t,e)}}))},n.handleInputValue=function(e,t,a){var r=e.target.value;n.setState(function(e){var n;switch(a.inputType){case O.number:n=P(r,a.defaultInput);break;case O.string:n=String(r).length>0?r:a.defaultInput;break;default:n=a.defaultInput}var o=e.inputs;return o.splice(t,1,n),{inputs:o}})},n.createLayerFields=function(){for(var e=[],t=0;t<n.props.operation.inputLayers;t++)e.push(r.a.createElement(A,{key:t,index:t,inputLayers:n.props.operation.inputLayers,layer:n.state.layers[t],onSwap:n.handleSwap,onDrop:n.handleDrop}));return e},n.handleDrop=function(e,t){n.setState(function(a){var r,o=n.checkLayers(e.id,a.layers);return o>-1?r=n.handleSwap(o,t,a.layers):(r=a.layers).splice(t,1,e),{layers:r}})},n.checkLayers=function(e,t){return t.indexOf(t.find(function(t){return null!==t&&t.id===e}))},n.handleSwap=function(e,t,n){var a=n[e];return n.splice(e,1,n[t]),n.splice(t,1,a),n},n.handleReset=function(){n.setState(function(){var e=n.getDefaultValues(n.props.operation.inputValues);return{layers:new Array(n.props.operation.inputLayers).fill(null),inputs:e,processing:!1}})},n.processingStart=function(){var e=n.state,t=e.layers,a=e.inputs,r=n.props.operation;if(void 0===t.find(function(e){return null===e})){var o=!0;r.inputValues&&r.inputValues.forEach(function(e,t){null!==a[t]&&0!==String(a[t]).length&&typeof a[t]===e.inputType||(o=!1)}),o&&(n.props.popup?n.openPopup(t,a):n.startProcessing(t,a))}},n.startProcessing=function(e,t){n.setState({processing:!0});var a=n.props.operation.script(e,t);n.processFinished(a)},n.openPopup=function(){n.setState({processing:!0})},n.processFinished=function(e){null!==e?n.props.onProcessingDone(e):alert("The processed area is empty"),n.handleReset()},n.closePopup=function(){n.setState({processing:!1})};var a=n.getDefaultValues(e.operation.inputValues);return n.state={layers:new Array(e.operation.inputLayers).fill(null),inputs:a,processing:!1},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.listOpen,a=t.popup,o=a?this.props.operation.popupComponent:"div";return r.a.createElement("div",{className:"template"},r.a.createElement(q.a,{open:a&&this.state.processing,modal:!0,onClose:this.closePopup},r.a.createElement(o,{layers:this.state.layers,inputs:this.state.inputs,onExecute:this.processFinished,onClose:this.closePopup})),r.a.createElement("div",{onClick:function(){return e.props.onToggle(e.props.operation.name)}},this.props.operation.name,this.props.operation.info&&r.a.createElement(q.a,{trigger:r.a.createElement("img",{src:z.a,className:"info-icon",alt:""}),position:"right top",on:"hover"},r.a.createElement("img",{style:{width:"300px"},src:this.props.operation.info,alt:""}))),n&&r.a.createElement("div",null,this.createLayerFields(),this.createInputFields(),r.a.createElement("button",{onClick:function(){return e.handleReset()},disabled:this.state.processing},"Clear"),r.a.createElement("button",{onClick:function(){return e.processingStart()},disabled:this.state.processing},"Start")))}}]),t}(a.Component),G=n(9);var W=n(89),Z=n.n(W),J=n(90),_=n.n(J),K=n(91),Q=n.n(K),$=n(92),H=n.n($),X=(n(241),{equal:"is Equal to",notEqual:"is not Equal to",greater:"is Greater than",less:"is Less than",greaterEqual:"is Greater or Equal to",lessEqual:"is Less or Equal to"}),Y={property:"property",operator:"operator",value:"value"},ee=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this,e))).loadAttributes=function(){var e=n.props.layers[0],t={};for(var a in e.data.features){var r=e.data.features[a];for(var o in r.properties){var i=r.properties[o];o in t?-1===t[o].indexOf(i)&&t[o].push(i):(t[o]=[i],n.setDataType(o,i))}}n.setState({properties:t})},n.setDataType=function(e,t){var a=null;a=isNaN(t)?O.string:O.number,n.setState(function(t){return{dataTypes:t.dataTypes.set(e,a)}})},n.onExecute=function(){var e=n.props.layers[0],t=Object.assign({},e.data);for(var a in t.features=[],e.data.features){var r=e.data.features[a];n.checkFilters(r.properties)&&t.features.push(r)}var o=n.state.name,i={name:o=o.length>0?o:"sp-"+e.name,data:t};n.props.onExecute(i)},n.checkFilters=function(e){var t=!0;for(var a in n.state.filters){var r=n.state.filters[a];n.fulfillCriteria(r,e[r.property])||(t=!1)}return t},n.fulfillCriteria=function(e,t){switch(e.operator){case X.equal:return t===e.value;case X.notEqual:return t!==e.value;case X.greater:return t>e.value;case X.less:return t<e.value;case X.greaterEqual:return t>=e.value;case X.lessEqual:return t<=e.value;default:return!1}},n.onCancel=function(){n.props.onClose()},n.addSelectField=function(){n.setState(function(e){var t=e.filters,a=Object.keys(e.properties)[0],r=n.getFilterForProperty(a,e);return t.push(r),{filters:t}})},n.getFilterForProperty=function(e,t){return{property:e,operator:n.getLegalComparators(t.dataTypes.get(e))[0],value:t.properties[e][0]}},n.getLegalComparators=function(e){switch(e){case O.string:return[X.equal,X.notEqual];case O.number:return Object.values(X);default:return null}},n.deleteSelection=function(e){n.setState(function(t){var n=t.filters;return n.splice(e,1),{filters:n}})},n.handleSelectionUpdate=function(e,t,a){var r=e.target.value;n.setState(function(e){var o=e.filters,i=o[t];switch(a){case Y.property:i=n.getFilterForProperty(r,e);break;case Y.operator:i.operator=r;break;case Y.value:i.value=r}return o.splice(t,1,i),{filters:o}})},n.createSelectFields=function(){var e=[],t=Object.keys(n.state.properties);return n.state.filters.forEach(function(a,o){var i=n.getLegalComparators(n.state.dataTypes.get(a.property)),s=n.state.properties[a.property];e.push(r.a.createElement("div",{key:o},n.createSelectField(t,a.property,Y.property,o),n.createSelectField(i,a.operator,Y.operator,o),n.createSelectField(s,a.value,Y.value,o),r.a.createElement("img",{src:I.a,alt:"",onClick:function(){return n.deleteSelection(o)}})))}),e},n.createSelectField=function(e,t,a,o){return r.a.createElement("select",{key:a,value:t,onChange:function(e){return n.handleSelectionUpdate(e,o,a)}},e.map(function(e,t){return r.a.createElement("option",{key:t,value:e},e)}))},n.handleNameChange=function(e){var t=e.target.value;n.setState({name:t})},n.state={filters:[],properties:{},dataTypes:new Map,processing:!1,name:""},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.loadAttributes(),this.addSelectField()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("span",null,"Name of new layer: "),r.a.createElement("input",{type:"text",value:this.state.name,onChange:function(t){return e.handleNameChange(t)}}),r.a.createElement("span",null,r.a.createElement("br",null),"Filters:"),this.createSelectFields(),r.a.createElement("button",{onClick:this.addSelectField,disabled:this.state.processing},"Add filter"),r.a.createElement("button",{onClick:this.onCancel,disabled:this.state.processing},"Cancel"),r.a.createElement("button",{onClick:this.onExecute,disabled:this.state.processing||0===this.state.filters.length},"Start"))}}]),t}(a.Component),te=[{name:"Buffer",inputLayers:1,inputValues:[ne("Buffer radius",100,O.number),ne("Dissolve(slow)",!1,O.boolean)],script:function(e,t){var n=e[0],a=t[0],r=t[1],o=n.name+"-buffer-"+a+"m",i=n.data;if(i=Object(G.buffer)(i,a,{units:"meters"}),r){for(var s=Object.assign({},i.features[0]),l=1;l<i.features.length;l++)s=Object(G.union)(s,i.features[l]);s.properties={geometryChanged:"yes"},i.features=[s]}return{name:o,data:i}},info:Z.a},{name:"Difference",inputLayers:2,inputValues:null,script:function(e,t){var n=e[0],a=e[1],r={name:n.name+"-difference-"+a.name},o=Object.assign({},n.data);o.features=[];for(var i=Object(G.buffer)(n.data,.1,{units:"meters"}),s=Object(G.buffer)(a.data,.1,{units:"meters"}),l=0;l<i.features.length;l++){for(var u=Object.assign({},i.features[l]),c=0;c<s.features.length&&null!==(u=Object(G.difference)(u,s.features[c]));c++);null!==u&&o.features.push(u)}return o.features[0]?(r.data=o,r):null},info:H.a},{name:"Intersection",inputLayers:2,inputValues:null,script:function(e,t){var n=e[0],a=e[1],r={name:n.name+"-intersect-"+a.name},o=Object.assign({},n.data);o.features=[];for(var i=Object(G.buffer)(n.data,.1,{units:"meters"}),s=Object(G.buffer)(a.data,.1,{units:"meters"}),l=0;l<i.features.length;l++)for(var u=i.features[l],c=0;c<s.features.length;c++){var p=s.features[c],d=Object(G.intersect)(u,p);null!==d&&o.features.push(d)}return o.features[0]?(r.data=o,r):null},info:_.a},{name:"Union(very slow)",inputLayers:2,inputValues:null,script:function(e,t){for(var n=e[0],a=e[1],r=n.name+"-union-"+a.name,o=Object(G.buffer)(n.data,.1,{units:"meters"}),i=Object(G.buffer)(a.data,.1,{units:"meters"}),s=Object.assign({},o.features[0]),l=1;l<o.features.length;l++)s=Object(G.union)(s,o.features[l]);for(var u=Object.assign({},i.features[0]),c=1;c<i.features.length;c++)u=Object(G.union)(u,i.features[c]);return{name:r,data:Object(G.union)(s,u)}},info:Q.a}];function ne(e,t,n){return{inputName:e,defaultInput:t,inputType:n}}var ae,re=[{name:"Select properties",inputLayers:1,inputValues:null,popupComponent:ee,info:null}],oe=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(o)))).state={operations:te,componentOperations:re,listOpen:null},n.handleToggle=function(e){n.setState(function(t){return t.listOpen===e?{listOpen:null}:{listOpen:e}})},n.createProcessingTemplate=function(e,t){return r.a.createElement(B,{key:e.name,operation:e,onToggle:n.handleToggle,onProcessingDone:n.props.onProcessingDone,listOpen:n.state.listOpen===e.name,popup:t})},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("div",{className:"group-divider"},"Geoprocessing"),this.state.componentOperations.map(function(t){return e.createProcessingTemplate(t,!0)}),this.state.operations.map(function(t){return e.createProcessingTemplate(t,!1)}))}}]),t}(a.Component),ie=n(94),se=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).handleUpload=function(e){var t=[],a=[],r=[];e.forEach(function(e){var n=e.name.toLowerCase();n.length>0&&(n.endsWith(".geojson")?r.push(e):n.endsWith(".gml")?a.push(e):y.filter(function(e){return n.endsWith(e)}).length>0?t.push(e):alert("Not valid filetype: "+n))}),n.props.onUpload(r)},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(ie.a,{className:"drop-zone",accept:".geojson, .gml, .dbf, .prj, .sbn, .sbx, .shp, .shx, .shp.xml",onDrop:function(t){e.handleUpload(t)}},r.a.createElement("div",null,"Click to upload files. Only geojson files"," can be uploaded")))}}]),t}(a.Component),le=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement("nav",{id:"sidebar",className:"navbar bg-light"},r.a.createElement(oe,{onProcessingDone:this.props.onProcessingDone}),r.a.createElement(V,{layerlist:this.props.layerlist,visiblemap:this.props.visiblemap,stylemap:this.props.stylemap,onDelete:this.props.onDelete,onToggle:this.props.onToggle,onMove:this.props.onMove,onZoom:this.props.onZoom,onNameChange:this.props.onNameChange,onStyleChange:this.props.onStyleChange}),r.a.createElement(se,{onUpload:this.props.onUpload}))}}]),t}(a.Component),ue=n(24),ce=n.n(ue),pe=(n(243),n(245),function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).state={mapid:"mapid",center:[63.42,10.55],zoom:12},n.zoomToLayer=function(e){var t=n.getLayerById(e);n.map.fitBounds(t.getBounds())},n.addLayer=function(e){var t=n.getLayerById(e.id);if(void 0===t)try{(t=ce.a.geoJSON(e.data)).id=e.id,n.featuregroup.addLayer(t)}catch(a){n.props.onError(e.id)}return t},n.removeLayer=function(e){var t=n.getLayerById(e);void 0!==t&&n.featuregroup.removeLayer(t)},n.getLayerById=function(e){return n.featuregroup.getLayers().find(function(t){return t.id===e})},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.map=this.createMap(this.state.mapid),this.featuregroup=ce.a.featureGroup(),this.featuregroup.addTo(this.map)}},{key:"createMap",value:function(e){var t=ce.a.map(e).setView(this.state.center,this.state.zoom);return ce.a.tileLayer("http://opencache.statkart.no/gatekeeper/gk/gk.open_gmaps?layers=norges_grunnkart&zoom={z}&x={x}&y={y}",{attribution:'<a href="http://www.kartverket.no/">Kartverket</a>'}).addTo(t),t.zoomControl.setPosition("topright"),t}},{key:"componentDidUpdate",value:function(){var e=this;this.props.layerlist.forEach(function(t){if(e.props.visiblemap.get(t.id)){var n=e.addLayer(t),a=e.props.stylemap.get(t.id);n.setStyle({color:a.color,opacity:a.opacity}),n.bringToBack()}else e.removeLayer(t.id)})}},{key:"render",value:function(){return r.a.createElement("div",{id:this.state.mapid})}}]),t}(a.Component)),de=(n(247),"gisdb"),fe="layers",ge=1,he=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this,e))).dbInit=function(){var e=indexedDB.open(de,ge);e.onerror=function(e){alert("Error with indexeddb")},e.onupgradeneeded=function(t){e.result.createObjectStore(fe,{keyPath:"id",autoIncrement:!0})},e.onsuccess=function(t){ae=e.result,n.loadLayers()}},n.loadLayers=function(){ae.transaction(fe,"readonly").objectStore(fe).getAll().onsuccess=function(e){n.addGeoJSONLayer(e.target.result)}},n.handleUpload=function(e){e.forEach(function(e){var t=null,a=new FileReader;a.onload=function(){try{var r=a.result;if(null!==(t=JSON.parse(r))){var o={name:e.name.toLowerCase().replace(".geojson",""),data:t};n.localSave(o)}}catch(i){return void alert("Error reading json file: "+i)}},a.readAsText(e)})},n.localSave=function(e){ae.transaction(fe,"readwrite").objectStore(fe).put(e).onsuccess=function(t){void 0===e.id&&(e.id=t.target.result,n.addGeoJSONLayer([e]))}},n.addGeoJSONLayer=function(e){e.forEach(function(e){console.log(e),n.setState(function(t){var a=t.layers;a.splice(0,0,e);var r=t.styles.get(e.id)?t.styles.get(e.id):n.setStyle(e.id);return{layers:a,visibility:t.visibility.set(e.id,!0),styles:t.styles.set(e.id,r)}})})},n.setStyle=function(e){return{color:function(e){var t=Math.round(16777215*Math.random()).toString(16),n=6-t.length;return"#"+"000000".substring(0,n)+t}(),opacity:.8}},n.handleDelete=function(e){n.deleteFromStorage(e),n.deleteFromState(e),n.deleteFromLeaflet(e)},n.handleZoom=function(e){n.leafletmap.current.zoomToLayer(e)},n.handleNameChange=function(e,t){e.name!==t&&t.length>0&&(e.name=t,n.localSave(e))},n.handleStyleChange=function(e,t){n.setState(function(n){var a=t.color,r=t.opacity,o=n.styles.get(e);return a=null!==a?a:o.color,r=null!==r?r:o.opacity,{styles:n.styles.set(e,{color:a,opacity:r})}})},n.deleteFromStorage=function(e){ae.transaction(fe,"readwrite").objectStore(fe).delete(e).onsuccess=function(e){}},n.deleteFromState=function(e){n.setState(function(t){return{layers:t.layers.filter(function(t){return t.id!==e})}})},n.deleteFromLeaflet=function(e){n.leafletmap.current.removeLayer(e)},n.handleError=function(e){n.handleDelete(e)},n.handleMove=function(e,t){n.setState(function(n){var a=function(e,t){var n=t.find(function(t){return t.id===e});return{index:t.indexOf(n),info:n}}(e,n.layers),r=n.layers;return r.splice(a.index,1),r.splice(t,0,a.info),{layers:r}})},n.handleProcessing=function(e){n.localSave(e)},n.handleToggle=function(e){n.setState(function(t){return{visibility:t.visibility.set(e,!t.visibility.get(e))}})},n.state={layers:[],visibility:new Map,styles:new Map},n.leafletmap=r.a.createRef(),n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.dbInit()}},{key:"componentWillUnmount",value:function(){ae.close()}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(le,{layerlist:this.state.layers,visiblemap:this.state.visibility,stylemap:this.state.styles,onUpload:this.handleUpload,onDelete:this.handleDelete,onToggle:this.handleToggle,onMove:this.handleMove,onZoom:this.handleZoom,onNameChange:this.handleNameChange,onStyleChange:this.handleStyleChange,onProcessingDone:this.handleProcessing}),r.a.createElement(pe,{ref:this.leafletmap,layerlist:this.state.layers,visiblemap:this.state.visibility,stylemap:this.state.styles,onError:this.handleError}))}}]),t}(a.Component),me=Object(d.DragDropContext)(g.a)(he),ye=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ve(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}i.a.render(r.a.createElement(me,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/Programming-in-Geomatics",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("/Programming-in-Geomatics","/service-worker.js");ye?(function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):ve(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):ve(e)})}}()},37:function(e,t,n){e.exports=n.p+"static/media/icondelete.d36bd4a7.svg"},54:function(e,t,n){},86:function(e,t,n){e.exports=n.p+"static/media/iconzoom.c135a649.svg"},87:function(e,t,n){e.exports=n.p+"static/media/iconsettings.674d9d35.svg"},88:function(e,t,n){e.exports=n.p+"static/media/iconinfo.7d03c90c.svg"},89:function(e,t,n){e.exports=n.p+"static/media/buffer.72eaeea6.png"},90:function(e,t,n){e.exports=n.p+"static/media/intersection.9866121b.png"},91:function(e,t,n){e.exports=n.p+"static/media/union.2f066b4c.png"},92:function(e,t,n){e.exports=n.p+"static/media/difference.679a0c19.png"},95:function(e,t,n){e.exports=n(249)}},[[95,2,1]]]);
//# sourceMappingURL=main.2ed6fb7b.chunk.js.map