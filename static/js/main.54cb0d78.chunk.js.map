{"version":3,"sources":["images/iconzoom.svg","images/iconsettings.svg","images/iconinfo.svg","images/buffer.png","images/intersection.png","images/union.png","images/difference.png","images/select.png","components/util/constants.js","components/layer.jsx","components/util/support.js","components/layerproperties.jsx","components/layerlist.jsx","components/processingfield.jsx","components/processingtemplate.jsx","components/processing/difference.js","components/processing/attributeselector.jsx","components/processing/operationtypes.js","components/processing/buffer.js","components/processing/intersection.js","components/processing/union.js","App.js","components/geoprocessing.jsx","components/upload.jsx","components/sidebar.jsx","components/leafletmap.jsx","registerServiceWorker.js","index.js","images/icondelete.svg"],"names":["module","exports","__webpack_require__","p","ItemTypes","InputTypes","PropTypes","number","isRequired","string","object","boolean","Actions","delete","zoom","properties","Layer","handleClick","action","_this","props","onDelete","layer","id","onZoom","openPopup","createContexMenu","react_default","a","createElement","es6","index","toString","createContexMenuItem","settingsIcon","divider","zoomIcon","deleteIcon","description","icon","onClick","src","className","alt","clipName","name","length","substring","concat","_this2","this","_this$props","isDragging","isOver","connectDragSource","connectDropTarget","style","opacity","backgroundColor","overflow","holdToDisplay","height","width","float","color","type","checked","visible","onChange","onToggle","Component","flow","DragSource","beginDrag","draggedId","draggedIndex","draggedName","draggedData","data","connect","monitor","dragSource","DropTarget","canDrop","getItem","drop","didDrop","onMove","dropTarget","validateNumberInput","inputValue","defaultValue","newValue","i","char","charAt","isNaN","Number","InputValues","Properties","Object","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","handleTextInput","evt","inputName","target","value","setState","prevState","inputs","set","handleRangeInput","min","max","String","ValidateRangeInput","applyChanges","onNameChange","state","get","onStyleChange","removeDialogue","onDialogueFinished","createPage","Fragment","textInput","colorInput","rangeInput","onEdit","Map","LayerList","stylemap","closePopup","reactjs_popup_es","open","modal","onClose","layerproperties","layerlist","map","components_layer","key","visiblemap","ProcessingField","hasLayer","canMove","inputLayers","border","cursor","canDrag","_monitor$getItem2","onDrop","ProcessingTemplate","getDefaultValues","inputValues","defaultInputs","forEach","push","defaultInput","createInputFields","operation","inputFields","createInputField","inputType","splice","event","handleInputValue","createLayerFields","processingfield","layers","onSwap","handleSwap","handleDrop","position","checkLayers","indexOf","find","currentIndex","nextIndex","handleReset","Array","fill","processing","processingStart","_this$state","undefined","canProcess","popup","startProcessing","script","processFinished","onProcessingDone","alert","listOpen","PopupComponent","popupComponent","onExecute","info","trigger","infoIcon","on","disabled","layerDifference","features1","features2","newFeatures","nextFeature","assign","j","difference","ComparisonMethods","equal","notEqual","greater","less","greaterEqual","lessEqual","AttributeType","property","operator","AttributeSelector","loadAttributes","featureID","features","feature","setDataType","dataTypes","checkFilters","newName","extractedLayer","fulfill","filterID","filters","filter","fulfillCriteria","onCancel","addSelectField","firstProperty","keys","getFilterForProperty","getLegalComparators","dataType","values","deleteSelection","pos","handleSelectionUpdate","createSelectFields","selectFields","comparators","createSelectField","valueChoices","defaultChoice","handleNameChange","operations","createInputValue","bufferValue","shouldDissolve","resultLayer","resultData","bufferLayer","buffer","units","dissolvedFeature","union","geometryChanged","dissolveFeatures","bufferImg","layer1","layer2","buffer1","buffer2","differenceImg","features3","layerIntersection","intersectionImg","feature1","feature2","unionImg","db","componentOperations","selectImg","Geoprocessing","handleToggle","createProcessingTemplate","processingtemplate","Upload","handleUpload","files","geoJsonFiles","file","filename","toLowerCase","endsWith","onUpload","es","accept","SideBar","geoprocessing","upload","LeafletMap","mapid","center","zoomToLayer","getLayerById","fitBounds","getBounds","addLayer","leaflayer","L","geoJSON","featuregroup","e","onError","removeLayer","getLayers","createMap","featureGroup","addTo","setView","tileLayer","attribution","zoomControl","setPosition","setStyle","bringToBack","DB_NAME","LAYER_STORE","DB_VERSION","App","dbInit","request","indexedDB","onerror","onupgradeneeded","result","createObjectStore","keyPath","autoIncrement","onsuccess","loadLayers","transaction","objectStore","getAll","addGeoJSONLayer","json","reader","FileReader","onload","datatext","JSON","parse","replace","localSave","ex","readAsText","put","console","log","styles","visibility","x","Math","round","random","y","getColor","handleDelete","deleteFromStorage","deleteFromState","deleteFromLeaflet","handleZoom","leafletmap","current","handleStyleChange","prevStyle","l","handleError","handleMove","newIndex","layerInfo","arraylist","t","getInfo","handleProcessing","React","createRef","close","components_sidebar","ref","DragDropContext","HTML5Backend","isLocalhost","Boolean","window","location","hostname","match","registerValidSW","swUrl","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","controller","catch","error","ReactDOM","render","src_App_0","document","getElementById","URL","process","origin","addEventListener","fetch","response","status","headers","ready","unregister","reload","checkValidServiceWorker","registerServiceWorker"],"mappings":"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","file":"static/js/main.54cb0d78.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/iconzoom.c135a649.svg\";","module.exports = __webpack_public_path__ + \"static/media/iconsettings.674d9d35.svg\";","module.exports = __webpack_public_path__ + \"static/media/iconinfo.7d03c90c.svg\";","module.exports = __webpack_public_path__ + \"static/media/buffer.85c38da2.png\";","module.exports = __webpack_public_path__ + \"static/media/intersection.77550d8c.png\";","module.exports = __webpack_public_path__ + \"static/media/union.2145c9ab.png\";","module.exports = __webpack_public_path__ + \"static/media/difference.d54ef46e.png\";","module.exports = __webpack_public_path__ + \"static/media/select.ac5c793b.png\";","import PropTypes from \"prop-types\";\r\n/**\r\n * Class for global constants\r\n */\r\nexport const ACCEPTED_FILE_TYPES = \".geojson\"; //,.zip, .gml, .dbf, .prj, .sbn, .sbx, .shp, .shx, .shp.xml\";\r\nexport const SHAPE_FORMATS = [\r\n  \".shp\",\r\n  \".dbf\",\r\n  \".prj\",\r\n  \".sbn\",\r\n  \".sbx\",\r\n  \".shx\",\r\n  \".shp.xml\"\r\n];\r\n/**\r\n * Targets and sources for drag and drop functionality.\r\n * Use these keywords when making draggable layer,\r\n * a droppable field for layers in an operation etc...\r\n */\r\nexport const ItemTypes = {\r\n  LAYER: \"layer\",\r\n  OPERATION: \"operation\"\r\n};\r\n/**\r\n * Proptypes template for layers\r\n */\r\nexport const LayerShape = {\r\n  id: PropTypes.number.isRequired,\r\n  name: PropTypes.string.isRequired,\r\n  data: PropTypes.object.isRequired\r\n};\r\n/**\r\n * Proptypes template for operations\r\n */\r\nexport const OperationShape = {\r\n  name: PropTypes.string.isRequired,\r\n  inputLayers: PropTypes.number.isRequired\r\n};\r\n/**\r\n * Object of string containing all valid inputtypes of user data\r\n */\r\nexport const InputTypes = {\r\n  number: \"number\",\r\n  boolean: \"boolean\",\r\n  string: \"string\"\r\n};\r\n","import React, { Component } from \"react\";\r\nimport { DragSource, DropTarget } from \"react-dnd\";\r\nimport { ItemTypes, LayerShape } from \"./util/constants\";\r\nimport \"./css/sidebar.css\";\r\nimport \"./css/contextmenu.css\";\r\nimport \"./css/popup.css\";\r\n\r\nimport flow from \"lodash/flow\";\r\nimport PropTypes from \"prop-types\";\r\nimport { ContextMenu, MenuItem, ContextMenuTrigger } from \"react-contextmenu\";\r\nimport zoomIcon from \"../images/iconzoom.svg\";\r\nimport settingsIcon from \"../images/iconsettings.svg\";\r\nimport deleteIcon from \"../images/icondelete.svg\";\r\n\r\n/**\r\n * The different actions in the layers right click menu\r\n */\r\nconst Actions = {\r\n  delete: \"delete\",\r\n  zoom: \"zoom\",\r\n  properties: \"properties\"\r\n};\r\n\r\n/**\r\n * For dragging the layer\r\n */\r\nconst layerSource = {\r\n  //Contains the info of the dragged layer\r\n  beginDrag(props) {\r\n    const item = {\r\n      draggedId: props.layer.id,\r\n      draggedIndex: props.index,\r\n      draggedName: props.layer.name,\r\n      draggedData: props.layer.data\r\n    };\r\n    return item;\r\n  }\r\n};\r\n/**\r\n * For dropping layers on each other and sorting the list of layers\r\n */\r\nconst layerTarget = {\r\n  //Should not be able to drop on the same layer\r\n  canDrop(props, monitor) {\r\n    let { draggedId } = monitor.getItem();\r\n    return draggedId !== props.layer.id;\r\n  },\r\n  //Move the layer to its new index in the layer list, 'App' handles the sorting\r\n  drop(props, monitor) {\r\n    if (!monitor.didDrop()) {\r\n      let { draggedId } = monitor.getItem();\r\n      props.onMove(draggedId, props.index);\r\n    }\r\n  }\r\n};\r\n/**\r\n * Attributes used to make a field droppable\r\n */\r\nfunction collectTarget(connect, monitor) {\r\n  return {\r\n    connectDropTarget: connect.dropTarget(),\r\n    isOver: monitor.isOver()\r\n  };\r\n}\r\n/**\r\n * Attributes used to make a field draggable\r\n */\r\nfunction collectSource(connect, monitor) {\r\n  return {\r\n    connectDragSource: connect.dragSource(),\r\n    isDragging: monitor.isDragging()\r\n  };\r\n}\r\n/**\r\n * Class for visualizing the geojson layer in the sidebar\r\n */\r\nclass Layer extends Component {\r\n  /**\r\n   * Method to decide which item was clicked and perform corresponding action\r\n   */\r\n  handleClick = action => {\r\n    if (action === Actions.delete) {\r\n      this.props.onDelete(this.props.layer.id);\r\n    } else if (action === Actions.zoom) {\r\n      this.props.onZoom(this.props.layer.id);\r\n    } else if (action === Actions.properties) {\r\n      this.props.openPopup(this.props.layer);\r\n    }\r\n  };\r\n  /**\r\n   * Creates right click menu for render function.\r\n   * Uses createContexMenuItem for every item in the list\r\n   */\r\n  createContexMenu = () => {\r\n    return (\r\n      <ContextMenu id={this.props.index.toString()}>\r\n        {this.createContexMenuItem(\r\n          Actions.properties,\r\n          \"Properties\",\r\n          settingsIcon\r\n        )}\r\n        <MenuItem divider />\r\n        {this.createContexMenuItem(Actions.zoom, \"Zoom to layer\", zoomIcon)}\r\n        <MenuItem divider />\r\n        {this.createContexMenuItem(Actions.delete, \"Delete layer\", deleteIcon)}\r\n      </ContextMenu>\r\n    );\r\n  };\r\n  /**\r\n   * Each item in the right click menu\r\n   * Has onClick function, description and a small icon\r\n   */\r\n  createContexMenuItem = (action, description, icon) => {\r\n    return (\r\n      <MenuItem onClick={() => this.handleClick(action)}>\r\n        {description}\r\n        <img src={icon} className=\"icon\" alt=\"\" />\r\n      </MenuItem>\r\n    );\r\n  };\r\n  /**\r\n   * Reduce too long layer names when shown to the user\r\n   */\r\n  clipName = () => {\r\n    let name = this.props.layer.name;\r\n    if (name.length > 24) {\r\n      name = name.substring(0, 25);\r\n      name = name.concat(\"...\");\r\n    }\r\n    return name;\r\n  };\r\n  /**\r\n   * Render function\r\n   * Contains right click menu with options\r\n   * Name of layer\r\n   * Square with color of layer\r\n   * Checkbox for toggling visibility\r\n   */\r\n  render() {\r\n    const {\r\n      isDragging,\r\n      isOver,\r\n      connectDragSource,\r\n      connectDropTarget\r\n    } = this.props;\r\n    return connectDragSource(\r\n      connectDropTarget(\r\n        <div\r\n          className=\"layer\"\r\n          style={{\r\n            opacity: isDragging ? 0 : 1,\r\n            backgroundColor: isOver\r\n              ? \"rgb(120, 120, 120)\"\r\n              : \"rgb(217, 217, 217)\",\r\n            overflow: \"auto\"\r\n          }}\r\n        >\r\n          <ContextMenuTrigger\r\n            id={this.props.index.toString()}\r\n            holdToDisplay={-1}\r\n          >\r\n            <span>{this.clipName()}</span>\r\n            <div\r\n              style={{\r\n                height: \"20px\",\r\n                width: \"20px\",\r\n                float: \"left\",\r\n                backgroundColor: this.props.style.color\r\n              }}\r\n            />\r\n            <input\r\n              type=\"checkbox\"\r\n              style={{ float: \"right\" }}\r\n              checked={this.props.visible}\r\n              onChange={() => this.props.onToggle(this.props.layer.id)}\r\n            />\r\n          </ContextMenuTrigger>\r\n          {this.createContexMenu()}\r\n        </div>\r\n      )\r\n    );\r\n  }\r\n}\r\n\r\nLayer.propTypes = {\r\n  layer: PropTypes.shape(LayerShape).isRequired,\r\n  index: PropTypes.number.isRequired,\r\n  isDragging: PropTypes.bool.isRequired,\r\n  isOver: PropTypes.bool.isRequired,\r\n  onMove: PropTypes.func\r\n};\r\n\r\nexport default flow(\r\n  DragSource(ItemTypes.LAYER, layerSource, collectSource),\r\n  DropTarget(ItemTypes.LAYER, layerTarget, collectTarget)\r\n)(Layer);\r\n","/**\r\n * Class for support functions\r\n */\r\n/**\r\n * Returns the index and content of the object with matching id in arraylist\r\n * @param {*} id\r\n * @param {*} arraylist\r\n */\r\nexport function getInfo(id, arraylist) {\r\n  const target = arraylist.find(t => t.id === id);\r\n  const index = arraylist.indexOf(target);\r\n  return { index: index, info: target };\r\n}\r\n\r\n/**\r\n * Gives a random color to a layer\r\n */\r\nexport function getColor(id) {\r\n  var x = Math.round(0xffffff * Math.random()).toString(16);\r\n  var y = 6 - x.length;\r\n  var z = \"000000\";\r\n  var z1 = z.substring(0, y);\r\n  return \"#\" + z1 + x;\r\n}\r\n/**\r\n * Checks if the input is a number, removes all parts of the inputvalue which are not numbers\r\n * Currently returns empty string if input is empty. Can return defaultvalue instead\r\n */\r\nexport function validateNumberInput(inputValue, defaultValue) {\r\n  if (inputValue.length === 0) {\r\n    return \"\";\r\n  }\r\n  let newValue = \"\";\r\n  for (let i = 0; i < inputValue.length; i++) {\r\n    let char = inputValue.charAt(i);\r\n    //Check if the char is a number\r\n    if (!isNaN(Number(char))) {\r\n      newValue += char;\r\n    }\r\n  }\r\n  return newValue.length > 0\r\n    ? Number(newValue)\r\n    : defaultValue !== null\r\n    ? defaultValue\r\n    : \"\";\r\n}\r\n","import React, { Component } from \"react\";\r\nimport \"./css/sidebar.css\";\r\nimport { validateNumberInput } from \"./util/support.js\";\r\nconst InputValues = {\r\n  name: \"Name: \",\r\n  color: \"Color: \",\r\n  opacity: \"Opacity: \"\r\n};\r\n/**\r\n * Class for the popup menu which allows changing properties of a layer\r\n */\r\nclass Properties extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    //Map input type to inputvalue\r\n    const inputs = new Map([\r\n      [InputValues.name, props.layer.name],\r\n      [InputValues.color, props.style.color],\r\n      [InputValues.opacity, props.style.opacity]\r\n    ]);\r\n    this.state = {\r\n      inputs: inputs\r\n    };\r\n  }\r\n  /**\r\n   * How textinput should be handled. Can check if the input is valid, nonempty...\r\n   */\r\n  handleTextInput = (evt, inputName, defaultValue) => {\r\n    let newValue = evt.target.value;\r\n    this.setState(prevState => {\r\n      return { inputs: prevState.inputs.set(inputName, newValue) };\r\n    });\r\n  };\r\n  /**\r\n   * Handle numerical input with min and max value.\r\n   * Remove all non-numerical values from input, check if remainder is not empty.\r\n   * If not empty, compare to min and max, if empty set as empty string\r\n   */\r\n  handleRangeInput = (evt, inputName, defaultValue, min, max) => {\r\n    let newValue = validateNumberInput(evt.target.value, defaultValue);\r\n    newValue =\r\n      String(newValue).length > 0\r\n        ? this.ValidateRangeInput(newValue / 100, defaultValue, min, max)\r\n        : \"\";\r\n    this.setState(prevState => {\r\n      return { inputs: prevState.inputs.set(inputName, newValue) };\r\n    });\r\n  };\r\n  /**\r\n   * Checks if inputValue is within the constraints. If not, returns max or min values\r\n   */\r\n  ValidateRangeInput = (inputValue, defaultValue, min, max) => {\r\n    if (Number(inputValue) < min) {\r\n      inputValue = min;\r\n    } else if (Number(inputValue) > max) {\r\n      inputValue = max;\r\n    }\r\n    return inputValue;\r\n  };\r\n  /**\r\n   * Calls App with changes to properties the user have entered.\r\n   * Validation is done in App component, we send null if the field should not be changes\r\n   */\r\n  applyChanges = () => {\r\n    this.props.onNameChange(\r\n      this.props.layer,\r\n      this.state.inputs.get(InputValues.name)\r\n    );\r\n    const color = this.state.inputs.get(InputValues.color);\r\n    const opacity = this.state.inputs.get(InputValues.opacity);\r\n    this.props.onStyleChange(this.props.layer.id, {\r\n      color: color.length > 0 ? color : null,\r\n      opacity: String(opacity).length > 0 ? opacity : null\r\n    });\r\n    this.removeDialogue();\r\n  };\r\n  /**\r\n   * Call parent to close properties popup\r\n   */\r\n  removeDialogue = () => {\r\n    this.props.onDialogueFinished();\r\n  };\r\n  /**\r\n   * Create the content of properties menu.\r\n   * Contains each property and a field for changing them in a vertial list\r\n   */\r\n  createPage = () => {\r\n    return (\r\n      <React.Fragment>\r\n        {this.textInput(\r\n          InputValues.name,\r\n          this.state.inputs.get(InputValues.name),\r\n          this.handleTextInput\r\n        )}\r\n        {this.colorInput(\r\n          InputValues.color,\r\n          this.state.inputs.get(InputValues.color),\r\n          this.handleTextInput\r\n        )}\r\n        {this.rangeInput(\r\n          InputValues.opacity,\r\n          String(this.state.inputs.get(InputValues.opacity)).length > 0\r\n            ? this.state.inputs.get(InputValues.opacity) * 100\r\n            : \"\",\r\n          0,\r\n          1,\r\n          this.handleRangeInput\r\n        )}\r\n        <button onClick={this.removeDialogue}>Cancel</button>\r\n        <button onClick={this.applyChanges}>Apply</button>\r\n      </React.Fragment>\r\n    );\r\n  };\r\n  textInput = (inputName, defaultValue, onEdit) => {\r\n    return (\r\n      <div>\r\n        {inputName}\r\n        <input\r\n          type=\"text\"\r\n          value={defaultValue}\r\n          onChange={evt => onEdit(evt, inputName, defaultValue)}\r\n        />\r\n      </div>\r\n    );\r\n  };\r\n  rangeInput = (inputName, defaultValue, min, max, onEdit) => {\r\n    return (\r\n      <div>\r\n        {inputName}\r\n        <input\r\n          type=\"text\"\r\n          style={{ width: \"50px\" }}\r\n          value={defaultValue}\r\n          onChange={evt => onEdit(evt, inputName, defaultValue, min, max)}\r\n        />\r\n        {\"%\"}\r\n      </div>\r\n    );\r\n  };\r\n  colorInput = (inputName, defaultValue, onEdit) => {\r\n    return (\r\n      <div>\r\n        {inputName}\r\n        <input\r\n          type=\"color\"\r\n          value={defaultValue}\r\n          onChange={evt => onEdit(evt, inputName, defaultValue)}\r\n        />\r\n      </div>\r\n    );\r\n  };\r\n  render() {\r\n    return (\r\n      <div className=\"properties-menu\">\r\n        {\"Layer properties\"}\r\n        {this.createPage()}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Properties;\r\n","import React, { Component } from \"react\";\r\nimport Layer from \"./layer\";\r\nimport \"./css/sidebar.css\";\r\nimport \"./css/popup.css\";\r\nimport PropTypes from \"prop-types\";\r\nimport { LayerShape } from \"./util/constants.js\";\r\nimport Properties from \"./layerproperties\";\r\nimport Popup from \"reactjs-popup\";\r\n\r\n/**\r\n * Class for listing all layers in the sidebar. Contains all layers\r\n */\r\nclass LayerList extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      openPopup: false,\r\n      layer: null,\r\n      style: null\r\n    };\r\n  }\r\n  /**\r\n   * Open properties popup for specific layer\r\n   */\r\n  openPopup = layer => {\r\n    this.setState({\r\n      openPopup: true,\r\n      layer: layer,\r\n      style: this.props.stylemap.get(layer.id)\r\n    });\r\n  };\r\n  closePopup = () => {\r\n    this.setState({\r\n      openPopup: false,\r\n      layer: null,\r\n      style: null\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Render function\r\n   * Contains popup with layer properties\r\n   * All layers in a vertical list under the title\r\n   */\r\n  render() {\r\n    return (\r\n      <div>\r\n        <div className=\"group-divider\">Layers</div>\r\n        <Popup open={this.state.openPopup} modal onClose={this.closePopup}>\r\n          <Properties\r\n            layer={this.state.layer}\r\n            style={this.state.style}\r\n            onNameChange={this.props.onNameChange}\r\n            onStyleChange={this.props.onStyleChange}\r\n            onDialogueFinished={this.closePopup}\r\n          />\r\n        </Popup>\r\n        {this.props.layerlist.map((layer, index) => (\r\n          <Layer\r\n            key={layer.id}\r\n            index={index}\r\n            layer={layer}\r\n            visible={this.props.visiblemap.get(layer.id)}\r\n            style={this.props.stylemap.get(layer.id)}\r\n            onDelete={this.props.onDelete}\r\n            onToggle={this.props.onToggle}\r\n            onMove={this.props.onMove}\r\n            onZoom={this.props.onZoom}\r\n            openPopup={this.openPopup}\r\n          />\r\n        ))}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nLayerList.propTypes = {\r\n  layerlist: PropTypes.arrayOf(PropTypes.shape(LayerShape)),\r\n  visiblemap: PropTypes.instanceOf(Map).isRequired,\r\n  onMove: PropTypes.func.isRequired,\r\n  layer: PropTypes.shape(LayerShape),\r\n  index: PropTypes.number,\r\n  visible: PropTypes.bool\r\n};\r\n\r\nexport default LayerList;\r\n","import React, { Component } from \"react\";\r\nimport { DragSource, DropTarget } from \"react-dnd\";\r\nimport PropTypes from \"prop-types\";\r\nimport { ItemTypes, LayerShape } from \"./util/constants.js\";\r\nimport flow from \"lodash/flow\";\r\nimport \"./css/sidebar.css\";\r\n\r\n/**\r\n * For dragging the inputlayer.\r\n */\r\nconst operationSource = {\r\n  //Contains the info of the dragged inputlayer\r\n  beginDrag(props) {\r\n    const item = {\r\n      draggedId: props.layer.id,\r\n      draggedName: props.layer.name,\r\n      draggedData: props.layer.data\r\n    };\r\n    return item;\r\n  },\r\n  //Can only drag inputfield if they contain a layer, and there are more than one inputfield\r\n  canDrag(props) {\r\n    if (props.inputLayers > 1) {\r\n      return props.layer !== null;\r\n    }\r\n    return false;\r\n  }\r\n};\r\n/**\r\n *For dropping layers in the inputfields, and changing the order of the layers\r\n */\r\nconst operationTarget = {\r\n  //Can drop if the field is empty, or if the layer is different from the dragged layer\r\n  canDrop(props, monitor) {\r\n    if (props.layer === null) {\r\n      return true;\r\n    }\r\n    const { draggedId } = monitor.getItem();\r\n    return props.layer.id !== draggedId;\r\n  },\r\n  //When dropping a layer, 'ProcessingTemplate' handle assigning layers to fields\r\n  drop(props, monitor) {\r\n    if (!monitor.didDrop()) {\r\n      const { draggedId, draggedName, draggedData } = monitor.getItem();\r\n      const layer = { id: draggedId, name: draggedName, data: draggedData };\r\n      props.onDrop(layer, props.index);\r\n    }\r\n  }\r\n};\r\n/**\r\n * Attributes used to make a field droppable\r\n */\r\nfunction collectTarget(connect, monitor) {\r\n  return {\r\n    connectDropTarget: connect.dropTarget(),\r\n    isOver: monitor.isOver()\r\n  };\r\n}\r\n/**\r\n * Attributes used to make a field draggable\r\n */\r\nfunction collectSource(connect, monitor) {\r\n  return {\r\n    connectDragSource: connect.dragSource(),\r\n    isDragging: monitor.isDragging()\r\n  };\r\n}\r\n/**\r\n * Class for the droppable layer field in each operation.\r\n * Layers can be dropped from the layer list or from other processingfields\r\n */\r\nclass ProcessingField extends Component {\r\n  /**\r\n   * Render function\r\n   * Contains a field which layers can be dropped on\r\n   */\r\n  render() {\r\n    const {\r\n      isDragging,\r\n      isOver,\r\n      connectDragSource,\r\n      connectDropTarget\r\n    } = this.props;\r\n    const hasLayer = this.props.layer !== null;\r\n    const canMove = hasLayer && this.props.inputLayers > 1;\r\n\r\n    return connectDragSource(\r\n      connectDropTarget(\r\n        <div\r\n          className=\"processing-field\"\r\n          style={{\r\n            opacity: isDragging ? 0 : isOver ? 0.8 : 1,\r\n            border: !hasLayer ? \"2px dotted black\" : \"2px solid black\",\r\n            cursor: canMove ? \"pointer\" : \"default\"\r\n          }}\r\n        >\r\n          {(!hasLayer && \"Drop layer \" + (this.props.index + 1) + \" here\") ||\r\n            (hasLayer && this.props.layer.name)}\r\n        </div>\r\n      )\r\n    );\r\n  }\r\n}\r\n\r\nProcessingField.propTypes = {\r\n  layer: PropTypes.shape(LayerShape),\r\n  hasLayer: PropTypes.bool,\r\n  isDragging: PropTypes.bool,\r\n  isOver: PropTypes.bool,\r\n  inputLayers: PropTypes.number.isRequired\r\n};\r\n\r\nexport default flow(\r\n  DragSource(ItemTypes.OPERATION, operationSource, collectSource),\r\n  DropTarget(\r\n    [ItemTypes.LAYER, ItemTypes.OPERATION],\r\n    operationTarget,\r\n    collectTarget\r\n  )\r\n)(ProcessingField);\r\n","import React, { Component } from \"react\";\r\nimport ProcessingField from \"./processingfield\";\r\nimport PropTypes from \"prop-types\";\r\nimport { OperationShape, LayerShape, InputTypes } from \"./util/constants\";\r\nimport \"./css/sidebar.css\";\r\nimport \"./css/popup.css\";\r\nimport { validateNumberInput } from \"./util/support.js\";\r\nimport infoIcon from \"../images/iconinfo.svg\";\r\nimport Popup from \"reactjs-popup\";\r\n\r\n/**\r\n * Base class for operations in the sidebar. Creates inputfields\r\n * and initiates the processing operation on the input layers\r\n */\r\nclass ProcessingTemplate extends Component {\r\n  /**\r\n   * Populates the template with default values for user input, if required,\r\n   * and array for inputlayers\r\n   */\r\n  constructor(props) {\r\n    super(props);\r\n    const defaultInputs = this.getDefaultValues(props.operation.inputValues);\r\n    this.state = {\r\n      layers: new Array(props.operation.inputLayers).fill(null),\r\n      inputs: defaultInputs,\r\n      processing: false\r\n    };\r\n  }\r\n  /**\r\n   * Returns array of all default inputvalues for the inputfields, or null if no inputvalues\r\n   */\r\n  getDefaultValues = inputValues => {\r\n    let defaultInputs = null;\r\n    if (inputValues) {\r\n      defaultInputs = [];\r\n      inputValues.forEach(inputValue => {\r\n        defaultInputs.push(\r\n          inputValue.defaultInput !== null ? inputValue.defaultInput : \"\"\r\n        );\r\n      });\r\n    }\r\n    return defaultInputs;\r\n  };\r\n  /**\r\n   * If the operation requires input in addition to the layers, create corresponding\r\n   * fields for user input here\r\n   */\r\n  createInputFields = () => {\r\n    const { inputValues } = this.props.operation;\r\n    let inputFields = null;\r\n    if (inputValues) {\r\n      inputFields = [];\r\n      inputValues.forEach((inputValue, index) => {\r\n        inputFields.push(this.createInputField(inputValue, index));\r\n      });\r\n    }\r\n    return inputFields;\r\n  };\r\n  /**\r\n   * Create a single inputfield, either a checkbox or an inputfield\r\n   */\r\n  createInputField = (inputValue, index) => {\r\n    if (inputValue.inputType === InputTypes.boolean) {\r\n      return (\r\n        <div key={index}>\r\n          {inputValue.inputName}\r\n          <input\r\n            type={\"checkbox\"}\r\n            checked={this.state.inputs[index]}\r\n            onChange={() =>\r\n              this.setState(prevState => {\r\n                const inputs = prevState.inputs;\r\n                inputs.splice(index, 1, !inputs[index]);\r\n                return { inputs: inputs };\r\n              })\r\n            }\r\n          />\r\n        </div>\r\n      );\r\n    } else {\r\n      return (\r\n        <div key={index}>\r\n          {inputValue.inputName}\r\n          <input\r\n            type={\"text\"}\r\n            value={this.state.inputs[index]}\r\n            onChange={event => this.handleInputValue(event, index, inputValue)}\r\n          />\r\n        </div>\r\n      );\r\n    }\r\n  };\r\n  /**\r\n   * Validates if the user input is non-empty and of correct type.\r\n   * If not, replaces value with the default value, or an empty string if no default\r\n   */\r\n  handleInputValue = (event, index, inputValue) => {\r\n    const value = event.target.value;\r\n    this.setState(prevState => {\r\n      let newValue;\r\n      switch (inputValue.inputType) {\r\n        case InputTypes.number:\r\n          newValue = validateNumberInput(value, inputValue.defaultInput);\r\n          break;\r\n        case InputTypes.string:\r\n          newValue = String(value).length > 0 ? value : inputValue.defaultInput;\r\n          break;\r\n        default:\r\n          newValue = inputValue.defaultInput;\r\n      }\r\n      const inputs = prevState.inputs;\r\n      inputs.splice(index, 1, newValue);\r\n      return { inputs: inputs };\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Creates drag-drop fields for layers, by amount specified in operation\r\n   */\r\n  createLayerFields = () => {\r\n    const inputFields = [];\r\n    for (let i = 0; i < this.props.operation.inputLayers; i++) {\r\n      inputFields.push(\r\n        <ProcessingField\r\n          key={i}\r\n          index={i}\r\n          inputLayers={this.props.operation.inputLayers}\r\n          layer={this.state.layers[i]}\r\n          onSwap={this.handleSwap}\r\n          onDrop={this.handleDrop}\r\n        />\r\n      );\r\n    }\r\n    return inputFields;\r\n  };\r\n  /**\r\n   * Handles dropping of a layer. If it already exists, move the layer to the new position,\r\n   * and swap places if a layer is already there.\r\n   * If new layer, replace the layer currently on that index\r\n   * @param {Object} layer The dropped layer\r\n   * @param {Number} index The new index of the layer\r\n   */\r\n  handleDrop = (layer, index) => {\r\n    this.setState(prevState => {\r\n      const position = this.checkLayers(layer.id, prevState.layers);\r\n      let layers;\r\n      if (position > -1) {\r\n        layers = this.handleSwap(position, index, prevState.layers);\r\n      } else {\r\n        layers = prevState.layers;\r\n        layers.splice(index, 1, layer);\r\n      }\r\n      return { layers: layers };\r\n    });\r\n  };\r\n  /**\r\n   * If layer with id already exists, return index of the layer\r\n   */\r\n  checkLayers = (id, layers) => {\r\n    return layers.indexOf(\r\n      layers.find(layer => layer !== null && layer.id === id)\r\n    );\r\n  };\r\n  /**\r\n   * Swaps positions of two layers\r\n   */\r\n  handleSwap = (currentIndex, nextIndex, layers) => {\r\n    const layer = layers[currentIndex];\r\n    layers.splice(currentIndex, 1, layers[nextIndex]);\r\n    layers.splice(nextIndex, 1, layer);\r\n    return layers;\r\n  };\r\n\r\n  /**\r\n   * Resets state to default values. Empty for layers, default values for inputs\r\n   */\r\n  handleReset = () => {\r\n    this.setState(() => {\r\n      const defaultInputs = this.getDefaultValues(\r\n        this.props.operation.inputValues\r\n      );\r\n      return {\r\n        layers: new Array(this.props.operation.inputLayers).fill(null),\r\n        inputs: defaultInputs,\r\n        processing: false\r\n      };\r\n    });\r\n  };\r\n  /**\r\n   * Checks if processing can start.\r\n   * Can start if not already processing, if no layer fields are empty,\r\n   * and if all inputs are valid\r\n   */\r\n  processingStart = () => {\r\n    const { layers, inputs } = this.state;\r\n    const { operation } = this.props;\r\n    if (layers.find(layer => layer === null) === undefined) {\r\n      let canProcess = true;\r\n      if (operation.inputValues) {\r\n        operation.inputValues.forEach((inputValue, index) => {\r\n          //Input must be non-null, non-empty, and of correct type\r\n          if (\r\n            inputs[index] === null ||\r\n            String(inputs[index]).length === 0 ||\r\n            typeof inputs[index] !== inputValue.inputType\r\n          ) {\r\n            canProcess = false;\r\n          }\r\n        });\r\n      }\r\n      if (canProcess) {\r\n        this.props.popup\r\n          ? this.openPopup(layers, inputs)\r\n          : this.startProcessing(layers, inputs);\r\n      }\r\n    }\r\n  };\r\n  /**\r\n   * Starts processing without popup\r\n   */\r\n  startProcessing = (layers, inputs) => {\r\n    this.setState({\r\n      processing: true\r\n    });\r\n    const layer = this.props.operation.script(layers, inputs);\r\n    this.processFinished(layer);\r\n  };\r\n  /**\r\n   * Opens the popup processing window\r\n   */\r\n  openPopup = () => {\r\n    this.setState({\r\n      processing: true\r\n    });\r\n  };\r\n  /**\r\n   * Callback for when processing is done. Adds the layer to the map,\r\n   * and resets all inputs for the operation\r\n   */\r\n  processFinished = layer => {\r\n    if (layer !== null) {\r\n      this.props.onProcessingDone(layer);\r\n    } else {\r\n      alert(\"The processed area is empty\");\r\n    }\r\n    this.handleReset();\r\n  };\r\n  closePopup = () => {\r\n    this.setState({ processing: false });\r\n  };\r\n\r\n  /**\r\n   * Render function\r\n   * The popup is only created if this type of operation needs a seperate window\r\n   * Creates layer and inputfields based on operation specifications\r\n   * Creates reset button and start button for processing. Start button is greyed out if\r\n   * a process is ongoing.\r\n   */\r\n  render() {\r\n    const { listOpen, popup } = this.props;\r\n    const PopupComponent = popup ? this.props.operation.popupComponent : \"div\";\r\n    return (\r\n      <div className=\"template\">\r\n        <Popup\r\n          open={popup && this.state.processing}\r\n          modal\r\n          onClose={this.closePopup}\r\n        >\r\n          <PopupComponent\r\n            layers={this.state.layers}\r\n            inputs={this.state.inputs}\r\n            onExecute={this.processFinished}\r\n            onClose={this.closePopup}\r\n          />\r\n        </Popup>\r\n        <div\r\n          style={{ overflow: \"auto\" }}\r\n          onClick={() => this.props.onToggle(this.props.operation.name)}\r\n        >\r\n          {this.props.operation.name}\r\n          {this.props.operation.info && (\r\n            <Popup\r\n              trigger={<img src={infoIcon} className=\"info-icon\" alt=\"\" />}\r\n              position=\"right top\"\r\n              on=\"hover\"\r\n            >\r\n              <img\r\n                style={{ width: \"350px\" }}\r\n                src={this.props.operation.info}\r\n                alt=\"\"\r\n              />\r\n            </Popup>\r\n          )}\r\n        </div>\r\n        {listOpen && (\r\n          <div>\r\n            {this.createLayerFields()}\r\n            {this.createInputFields()}\r\n            <button\r\n              onClick={() => this.handleReset()}\r\n              disabled={this.state.processing}\r\n            >\r\n              Clear\r\n            </button>\r\n            <button\r\n              onClick={() => this.processingStart()}\r\n              disabled={this.state.processing}\r\n            >\r\n              Start\r\n            </button>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nProcessingTemplate.propTypes = {\r\n  operation: PropTypes.shape(OperationShape).isRequired,\r\n  layer: PropTypes.shape(LayerShape),\r\n  onProcessingDone: PropTypes.func.isRequired,\r\n  onToggle: PropTypes.func.isRequired,\r\n  processing: PropTypes.bool\r\n};\r\n\r\nexport default ProcessingTemplate;\r\n","/**\r\n * Javacript class for finding difference between geojson layers\r\n * Takes two layers and show the area of the first layer, excluding the second layer\r\n */\r\n\r\nimport { difference, buffer } from \"@turf/turf\";\r\n/**\r\n * Takes two layers and returns the part of the first which does not overlap any part of the second\r\n * @param {Array} layers Array of layers. Contains 2 layers in this operation\r\n * @param {Array|Null} inputs Array of inputs. Null in this operation\r\n */\r\nexport function differenceScript(layers, inputs) {\r\n  const layer1 = layers[0];\r\n  const layer2 = layers[1];\r\n  const name = layer1.name + \"-Diff-\" + layer2.name;\r\n\r\n  const resultLayer = { name: name };\r\n  const resultData = Object.assign({}, layer1.data);\r\n\r\n  //Perform buffer operation to transform data to polygons\r\n  let buffer1 = buffer(layer1.data, 0.1, { units: \"meters\" });\r\n  let buffer2 = buffer(layer2.data, 0.1, { units: \"meters\" });\r\n\r\n  resultData.features = layerDifference(buffer1.features, buffer2.features);\r\n\r\n  if (resultData.features.length === 0) {\r\n    return null;\r\n  } else {\r\n    resultLayer.data = resultData;\r\n    return resultLayer;\r\n  }\r\n}\r\n/**\r\n * For each feature in features1, take the difference from all features in features2.\r\n * If the result is not null we add the difference to a new feature list\r\n */\r\nexport function layerDifference(features1, features2) {\r\n  const newFeatures = [];\r\n  for (let i = 0; i < features1.length; i++) {\r\n    let nextFeature = Object.assign({}, features1[i]);\r\n    for (let j = 0; j < features2.length; j++) {\r\n      nextFeature = difference(nextFeature, features2[j]);\r\n      if (nextFeature === null) {\r\n        break;\r\n      }\r\n    }\r\n    if (nextFeature !== null) {\r\n      newFeatures.push(nextFeature);\r\n    }\r\n  }\r\n  return newFeatures;\r\n}\r\n","import React, { Component } from \"react\";\r\nimport { InputTypes } from \"../util/constants\";\r\nimport \"../css/sidebar.css\";\r\nimport deleteIcon from \"../../images/icondelete.svg\";\r\n\r\n/**\r\n * The ways property values can be compared when selecting data from layerfiles.\r\n */\r\nexport const ComparisonMethods = {\r\n  equal: \"is Equal to\",\r\n  notEqual: \"is not Equal to\",\r\n  greater: \"is Greater than\",\r\n  less: \"is Less than\",\r\n  greaterEqual: \"is Greater or Equal to\",\r\n  lessEqual: \"is Less or Equal to\"\r\n};\r\n/**\r\n * The datatypes in the three drop down menus\r\n */\r\nexport const AttributeType = {\r\n  property: \"property\",\r\n  operator: \"operator\",\r\n  value: \"value\"\r\n};\r\n/**\r\n * Class for selecting specific attributes from a layer and creating a new layer from them\r\n */\r\nclass AttributeSelector extends Component {\r\n  /**\r\n   * Datatypes:\r\n   * @param {Array} filters: Array of objects. Objects contain: property, operator, comparison value\r\n   * @param {Object} properties: Object with arrays. Keys are properties, values are array of property values\r\n   * @param {Map} datatypes: Map over the datatype each property contains\r\n   */\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      filters: [],\r\n      properties: {},\r\n      dataTypes: new Map(),\r\n      processing: false,\r\n      name: \"\"\r\n    };\r\n  }\r\n  /**\r\n   * Analyse values in the inputlayer, create an initial selectField\r\n   */\r\n  componentDidMount() {\r\n    this.loadAttributes();\r\n    this.addSelectField();\r\n  }\r\n  /**\r\n   * Go through each feature in the layer data, find all property types\r\n   * and add the property type and its possible values to a list.\r\n   */\r\n  loadAttributes = () => {\r\n    const layer = this.props.layers[0];\r\n    const properties = {};\r\n    for (let featureID in layer.data.features) {\r\n      const feature = layer.data.features[featureID];\r\n      for (let property in feature.properties) {\r\n        const newValue = feature.properties[property];\r\n        //Check if 'property' has been added before\r\n        if (property in properties) {\r\n          //Check if the new value has not been added before\r\n          if (properties[property].indexOf(newValue) === -1) {\r\n            properties[property].push(newValue);\r\n          }\r\n        }\r\n        //Initialize a list containing the possible values for 'property'\r\n        else {\r\n          properties[property] = [newValue];\r\n          this.setDataType(property, newValue);\r\n        }\r\n      }\r\n    }\r\n    this.setState({ properties: properties });\r\n  };\r\n  /**\r\n   * Set the datatype for each property. Can be string or number.\r\n   * Is used to determine which operators the user can use, ie: <, > may only be used on numbers\r\n   * @param {} property Property field from layer. Ex: \"road type\", \"water depth\".\r\n   * @param {} value Corresponding value of the property field. Ex: \"highway\", \"15\".\r\n   */\r\n  setDataType = (property, value) => {\r\n    let type = null;\r\n    if (!isNaN(value)) {\r\n      type = InputTypes.number;\r\n    } else {\r\n      type = InputTypes.string;\r\n    }\r\n    this.setState(prevState => {\r\n      return { dataTypes: prevState.dataTypes.set(property, type) };\r\n    });\r\n  };\r\n  /**\r\n   * Goes through the filters the user has chosen and creates a new layer based on them.\r\n   * If the user has entered a name, it is added to the new layer\r\n   */\r\n  onExecute = () => {\r\n    const layer = this.props.layers[0];\r\n    const data = Object.assign({}, layer.data);\r\n    data.features = [];\r\n    for (let featureID in layer.data.features) {\r\n      const feature = layer.data.features[featureID];\r\n      if (this.checkFilters(feature.properties)) {\r\n        data.features.push(feature);\r\n      }\r\n    }\r\n    let newName = this.state.name;\r\n    newName = newName.length > 0 ? newName : \"SP-\" + layer.name;\r\n    const extractedLayer = { name: newName, data: data };\r\n    this.props.onExecute(extractedLayer);\r\n  };\r\n  /**\r\n   * Check if the feature fulfills all selection criteria\r\n   */\r\n  checkFilters = properties => {\r\n    let fulfill = true;\r\n    for (let filterID in this.state.filters) {\r\n      const filter = this.state.filters[filterID];\r\n      if (!this.fulfillCriteria(filter, properties[filter.property])) {\r\n        fulfill = false;\r\n      }\r\n    }\r\n    return fulfill;\r\n  };\r\n  /**\r\n   * Compares the filter value to the inputvalue using the comparison method.\r\n   */\r\n  fulfillCriteria = (filter, value) => {\r\n    switch (filter.operator) {\r\n      case ComparisonMethods.equal:\r\n        return value === filter.value;\r\n      case ComparisonMethods.notEqual:\r\n        return value !== filter.value;\r\n      case ComparisonMethods.greater:\r\n        return value > filter.value;\r\n      case ComparisonMethods.less:\r\n        return value < filter.value;\r\n      case ComparisonMethods.greaterEqual:\r\n        return value >= filter.value;\r\n      case ComparisonMethods.lessEqual:\r\n        return value <= filter.value;\r\n      default:\r\n        return false;\r\n    }\r\n  };\r\n  /**\r\n   * Cancels the attribute selection without applying any filters\r\n   */\r\n  onCancel = () => {\r\n    this.props.onClose();\r\n  };\r\n  /**\r\n   * Add a new base selectfield to filters. Uses the first available property and its\r\n   * first legal operator and value\r\n   */\r\n  addSelectField = () => {\r\n    this.setState(prevState => {\r\n      const filters = prevState.filters;\r\n      const firstProperty = Object.keys(prevState.properties)[0];\r\n      const filter = this.getFilterForProperty(firstProperty, prevState);\r\n      filters.push(filter);\r\n      return { filters: filters };\r\n    });\r\n  };\r\n  /**\r\n   * Returns a valid filter for a specific property, with\r\n   * the first operator and value as its default values\r\n   */\r\n  getFilterForProperty = (property, prevState) => {\r\n    const filter = {\r\n      property: property,\r\n      operator: this.getLegalComparators(prevState.dataTypes.get(property))[0],\r\n      value: prevState.properties[property][0]\r\n    };\r\n    return filter;\r\n  };\r\n  /**\r\n   * Returns the comparators that can be used on a specific datatype.\r\n   * Strings can only have equals (=) and not equals (!=).\r\n   * Numbers can have all comparison methods\r\n   */\r\n  getLegalComparators = dataType => {\r\n    switch (dataType) {\r\n      case InputTypes.string:\r\n        return [ComparisonMethods.equal, ComparisonMethods.notEqual];\r\n      case InputTypes.number:\r\n        return Object.values(ComparisonMethods);\r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n  /**\r\n   * User deletes specific filter\r\n   */\r\n  deleteSelection = pos => {\r\n    this.setState(prevState => {\r\n      const filters = prevState.filters;\r\n      filters.splice(pos, 1);\r\n      return { filters: filters };\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Handles user input to a filter. Updates a filter object with the new\r\n   * value, according to which AttributeType is is\r\n   */\r\n  handleSelectionUpdate = (event, pos, type) => {\r\n    const newValue = event.target.value;\r\n    this.setState(prevState => {\r\n      const filters = prevState.filters;\r\n      let filter = filters[pos];\r\n      switch (type) {\r\n        //Need to update the property and its possible values\r\n        case AttributeType.property:\r\n          filter = this.getFilterForProperty(newValue, prevState);\r\n          break;\r\n        case AttributeType.operator:\r\n          filter.operator = newValue;\r\n          break;\r\n        case AttributeType.value:\r\n          filter.value = newValue;\r\n          break;\r\n        default:\r\n      }\r\n      filters.splice(pos, 1, filter);\r\n      return { filters: filters };\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Creates 3 drop down menus for filtering data from a layer.\r\n   * Menu for Attribute Property, Operator and Value,\r\n   * plus button for deleting the filter\r\n   */\r\n  createSelectFields = () => {\r\n    const selectFields = [];\r\n    const properties = Object.keys(this.state.properties);\r\n    this.state.filters.forEach((filter, position) => {\r\n      if (position > 0) {\r\n        selectFields.push(<span>and</span>);\r\n      }\r\n      const comparators = this.getLegalComparators(\r\n        this.state.dataTypes.get(filter.property)\r\n      );\r\n      const values = this.state.properties[filter.property];\r\n      selectFields.push(\r\n        <div key={position}>\r\n          {this.createSelectField(\r\n            properties,\r\n            filter.property,\r\n            AttributeType.property,\r\n            position\r\n          )}\r\n          {this.createSelectField(\r\n            comparators,\r\n            filter.operator,\r\n            AttributeType.operator,\r\n            position\r\n          )}\r\n          {this.createSelectField(\r\n            values,\r\n            filter.value,\r\n            AttributeType.value,\r\n            position\r\n          )}\r\n          <img\r\n            src={deleteIcon}\r\n            alt=\"\"\r\n            onClick={() => this.deleteSelection(position)}\r\n          />\r\n        </div>\r\n      );\r\n    });\r\n    return selectFields;\r\n  };\r\n  /**\r\n   * Creates drop down menu with options from 'valueChoices'\r\n   */\r\n  createSelectField = (valueChoices, defaultChoice, type, pos) => {\r\n    return (\r\n      <select\r\n        key={type}\r\n        value={defaultChoice}\r\n        onChange={event => this.handleSelectionUpdate(event, pos, type)}\r\n      >\r\n        {valueChoices.map((value, index) => (\r\n          <option key={index} value={value}>\r\n            {value}\r\n          </option>\r\n        ))}\r\n      </select>\r\n    );\r\n  };\r\n  handleNameChange = event => {\r\n    const name = event.target.value;\r\n    this.setState({ name: name });\r\n  };\r\n\r\n  /**\r\n   * Render function\r\n   * Contains field for giving a name to the new layer\r\n   * Fields for filtering layer data\r\n   * Button for adding new filters\r\n   * Cancel button and start button\r\n   */\r\n  render() {\r\n    return (\r\n      <div>\r\n        <span>Name of new layer: </span>\r\n        <input\r\n          type={\"text\"}\r\n          value={this.state.name}\r\n          onChange={event => this.handleNameChange(event)}\r\n        />\r\n        <span>\r\n          <br />\r\n          Select features from layer where:\r\n        </span>\r\n        {this.createSelectFields()}\r\n        <button onClick={this.addSelectField} disabled={this.state.processing}>\r\n          Add filter\r\n        </button>\r\n        <button onClick={this.onCancel} disabled={this.state.processing}>\r\n          Cancel\r\n        </button>\r\n        <button\r\n          onClick={this.onExecute}\r\n          disabled={this.state.processing || this.state.filters.length === 0}\r\n        >\r\n          Start\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default AttributeSelector;\r\n","import { InputTypes } from \"../util/constants.js\";\r\nimport { bufferScript } from \"./buffer.js\";\r\nimport { intersectionScript } from \"./intersection.js\";\r\nimport { unionScript } from \"./union.js\";\r\nimport { differenceScript } from \"./difference\";\r\n\r\nimport bufferImg from \"../../images/buffer.png\";\r\nimport intersectionImg from \"../../images/intersection.png\";\r\nimport unionImg from \"../../images/union.png\";\r\nimport differenceImg from \"../../images/difference.png\";\r\nimport selectImg from \"../../images/select.png\";\r\n\r\nimport AttributeSelector from \"./attributeselector\";\r\n\r\n/**\r\n * Array of processing operators that do not need a special window for user input\r\n *\r\n * Format:\r\n * @param {String} name: Name of operation, must be unique\r\n * @param {Number} inputLayers: Inputlayers for the operation. Must be 1 or more\r\n * @param {Array|Null} inputValues: Which extra inputvalues the operation uses. Null if no extra input,\r\n * an array of objects describing the input is othervise\r\n * @param {Function} script: The js function which contains the operation\r\n * @param {Image|Null} info: A descriptive image of the operation. An image link or null if no image\r\n */\r\nexport const operations = [\r\n  {\r\n    name: \"Buffer\",\r\n    inputLayers: 1,\r\n    inputValues: [\r\n      createInputValue(\"Buffer value\", 100, InputTypes.number),\r\n      createInputValue(\"Dissolve (slow)\", false, InputTypes.boolean)\r\n    ],\r\n    script: bufferScript,\r\n    info: bufferImg\r\n  },\r\n  {\r\n    name: \"Difference\",\r\n    inputLayers: 2,\r\n    inputValues: null,\r\n    script: differenceScript,\r\n    info: differenceImg\r\n  },\r\n  {\r\n    name: \"Intersection\",\r\n    inputLayers: 2,\r\n    inputValues: null,\r\n    script: intersectionScript,\r\n    info: intersectionImg\r\n  },\r\n  {\r\n    name: \"Union(very slow)\",\r\n    inputLayers: 2,\r\n    inputValues: null,\r\n    script: unionScript,\r\n    info: unionImg\r\n  }\r\n];\r\n/**\r\n * Creates objects describing inputvalue fields.\r\n * @param {String} inputName Name of inputvalue\r\n * @param {InputTypes} defaultInput Default value used as inputvalue\r\n * @param {InputTypes} inputType Type of inputvalue\r\n */\r\nfunction createInputValue(inputName, defaultInput, inputType) {\r\n  return {\r\n    inputName: inputName,\r\n    defaultInput: defaultInput,\r\n    inputType: inputType\r\n  };\r\n}\r\n\r\n/**\r\n * Operations needing additional user interaction, like feature extractors.\r\n * Must have a component describing the popupwindow\r\n *\r\n * Format:\r\n * @param {String} name: Name of operation, must be unique\r\n * @param {Number} inputLayers: Inputlayers for the operation. Must be 1 or more\r\n * @param {Array|Null} inputValues: Which extra inputvalues the operation uses. Null if no extra input,\r\n * an array of objects describing the input is othervise\r\n * @param {Function} popupComponent: The jsx component describing the popup window for the operation\r\n * @param {Image|Null} info: A descriptive image of the operation. An image link or null if no image\r\n */\r\nexport const componentOperations = [\r\n  {\r\n    name: \"Select properties\",\r\n    inputLayers: 1,\r\n    inputValues: null,\r\n    popupComponent: AttributeSelector,\r\n    info: selectImg\r\n  }\r\n];\r\n","import { buffer, union } from \"@turf/turf\";\r\n/**\r\n * Adds a buffer around the input layer and returns the new buffered layer.\r\n * @param {Array} layers Array of layers. Contains 1 layer in this operation\r\n * @param {Array|Null} inputs Array of inputs. Containts 2 inputs in this operation\r\n */\r\nexport function bufferScript(layers, inputs) {\r\n  const layer = layers[0];\r\n  const bufferValue = inputs[0];\r\n  const shouldDissolve = inputs[1];\r\n  const name = layer.name + \"-Buf-\" + bufferValue + \"m\";\r\n\r\n  const resultLayer = { name: name };\r\n  const resultData = Object.assign({}, layer.data);\r\n\r\n  const bufferLayer = buffer(layer.data, bufferValue, {\r\n    units: \"meters\"\r\n  });\r\n  //Dissolve all buffer features\r\n  if (shouldDissolve) {\r\n    bufferLayer.features = dissolveFeatures(bufferLayer.features);\r\n  }\r\n  resultData.features = bufferLayer.features;\r\n  resultLayer.data = resultData;\r\n  return resultLayer;\r\n}\r\n/**\r\n * Takes the union a feature to all other features, removes the previous properties\r\n * as they no longer makes sense with our dissolved features\r\n */\r\nfunction dissolveFeatures(features) {\r\n  let dissolvedFeature = Object.assign({}, features[0]);\r\n  for (let i = 1; i < features.length; i++) {\r\n    dissolvedFeature = union(dissolvedFeature, features[i]);\r\n  }\r\n  dissolvedFeature.properties = { geometryChanged: \"yes\" };\r\n  return [dissolvedFeature];\r\n}\r\n","import { buffer } from \"@turf/turf\";\r\nimport { layerDifference } from \"./difference\";\r\n/**\r\n * Takes two layers and returns a new layer containing the intersection between them\r\n * @param {Array} layers Array of layers. Contains 2 layers in this operation\r\n * @param {Array|Null} inputs Array of inputs. Null in this operation\r\n */\r\nexport function intersectionScript(layers, inputs) {\r\n  const layer1 = layers[0];\r\n  const layer2 = layers[1];\r\n  const name = layer1.name + \"-Int-\" + layer2.name;\r\n\r\n  const resultLayer = { name: name };\r\n  const resultData = Object.assign({}, layer1.data);\r\n\r\n  //Perform buffer operation to transform data to polygons\r\n  let buffer1 = buffer(layer1.data, 0.1, { units: \"meters\" });\r\n  let buffer2 = buffer(layer2.data, 0.1, { units: \"meters\" });\r\n\r\n  resultData.features = layerIntersection(buffer1.features, buffer2.features);\r\n\r\n  if (resultData.features.length === 0) {\r\n    return null;\r\n  } else {\r\n    resultLayer.data = resultData;\r\n    return resultLayer;\r\n  }\r\n}\r\n/**\r\n * Since Turfs intersection method does not always work as expected,\r\n * we instead perform two difference operations to get same result\r\n */\r\nfunction layerIntersection(features1, features2) {\r\n  const features3 = layerDifference(features2, features1);\r\n  return layerDifference(features2, features3);\r\n  /**\r\n   * For each feature in both layers, checks the overlapping area and\r\n   * adds it to a new layer.\r\n   * Not used, as Turfs intersection method does not give the correct overlapping area\r\n   */\r\n  /*\r\n  for (let i = 0; i < buffer1.features.length; i++) {\r\n    const feature1 = buffer1.features[i];\r\n    for (let j = 0; j < buffer2.features.length; j++) {\r\n      const feature2 = buffer2.features[j];\r\n      const intersectPolygon = intersect(feature1, feature2);\r\n      if (intersectPolygon !== null) {\r\n        resultData.features.push(intersectPolygon);\r\n      }\r\n    }\r\n  }\r\n  */\r\n}\r\n","/**\r\n * Javacript class for finding intersection between geojson layers\r\n * Takes two layers and returns layer containing intersection\r\n * First input is array of layers\r\n */\r\n\r\nimport { union, buffer } from \"@turf/turf\";\r\n/**\r\n * Takes two layers and merges them\r\n * @param {Array} layers Array of layers. Contains 2 layers in this operation\r\n * @param {Array|Null} inputs Array of inputs. Null in this operation\r\n */\r\nexport function unionScript(layers, inputs) {\r\n  const layer1 = layers[0];\r\n  const layer2 = layers[1];\r\n  const name = layer1.name + \"-Uni-\" + layer2.name;\r\n\r\n  const resultLayer = { name: name };\r\n  const resultData = Object.assign({}, layer1.data);\r\n\r\n  let buffer1 = buffer(layer1.data, 0.1, { units: \"meters\" });\r\n  let buffer2 = buffer(layer2.data, 0.1, { units: \"meters\" });\r\n\r\n  //Merge all features in layer1\r\n  let feature1 = Object.assign({}, buffer1.features[0]);\r\n  for (let i = 1; i < buffer1.features.length; i++) {\r\n    feature1 = union(feature1, buffer1.features[i]);\r\n  }\r\n  //Merge all features in layer2\r\n  let feature2 = Object.assign({}, buffer2.features[0]);\r\n  for (let i = 1; i < buffer2.features.length; i++) {\r\n    feature2 = union(feature2, buffer2.features[i]);\r\n  }\r\n  //Return the union of the two merged layers\r\n  resultData.features = [union(feature1, feature2)];\r\n  resultLayer.data = resultData;\r\n  return resultLayer;\r\n}\r\n","import React, { Component } from \"react\";\r\nimport { DragDropContext } from \"react-dnd\";\r\nimport HTML5Backend from \"react-dnd-html5-backend\";\r\nimport SideBar from \"./components/sidebar\";\r\nimport LeafletMap from \"./components/leafletmap\";\r\nimport { getInfo, getColor } from \"./components/util/support.js\";\r\nimport { LayerShape } from \"./components/util/constants.js\";\r\nimport PropTypes from \"prop-types\";\r\nimport \"./App.css\";\r\n\r\nconst DB_NAME = \"gisdb\";\r\nconst LAYER_STORE = \"layers\";\r\n//const GROUP_STORE = \"groups\";\r\nconst DB_VERSION = 1;\r\nvar db;\r\n\r\n/**\r\n * Controller class for website. Responsible for creating all components\r\n * and contains current system state\r\n */\r\nclass App extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      layers: [],\r\n      visibility: new Map(),\r\n      styles: new Map()\r\n    };\r\n    this.leafletmap = React.createRef();\r\n  }\r\n  /**\r\n   * Initialize database, retrieve locally saved layers\r\n   */\r\n  componentDidMount() {\r\n    this.dbInit();\r\n  }\r\n  /**\r\n   * Close database connection\r\n   */\r\n  componentWillUnmount() {\r\n    db.close();\r\n  }\r\n  /**\r\n   * Initialize database if not created, and reads saved layers\r\n   */\r\n  dbInit = () => {\r\n    let request = indexedDB.open(DB_NAME, DB_VERSION);\r\n    request.onerror = event => {\r\n      alert(\"Error with indexeddb\");\r\n    };\r\n    //Database is not created, create new\r\n    request.onupgradeneeded = event => {\r\n      request.result.createObjectStore(LAYER_STORE, {\r\n        keyPath: \"id\",\r\n        autoIncrement: true\r\n      });\r\n    };\r\n    request.onsuccess = event => {\r\n      db = request.result;\r\n      this.loadLayers();\r\n    };\r\n  };\r\n  /**\r\n   * Load layers from indexeddb and insert into state\r\n   */\r\n  loadLayers = () => {\r\n    let dbload = db.transaction(LAYER_STORE, \"readonly\");\r\n    let objstore = dbload.objectStore(LAYER_STORE);\r\n\r\n    let request = objstore.getAll();\r\n    request.onsuccess = event => {\r\n      this.addGeoJSONLayer(event.target.result);\r\n    };\r\n  };\r\n  /**\r\n   * Handles uploaded and converted geojson files.\r\n   * Reads content and saves if not empty\r\n   * @param {File} file, geojson file to be read and saved\r\n   */\r\n  handleUpload = files => {\r\n    files.forEach(file => {\r\n      let json = null;\r\n      let reader = new FileReader();\r\n      reader.onload = () => {\r\n        try {\r\n          let datatext = reader.result;\r\n          json = JSON.parse(datatext);\r\n          if (json !== null) {\r\n            let layer = {\r\n              name: file.name.toLowerCase().replace(\".geojson\", \"\"),\r\n              data: json\r\n            };\r\n            this.localSave(layer);\r\n          }\r\n        } catch (ex) {\r\n          alert(\"Error reading json file: \" + ex);\r\n          return;\r\n        }\r\n      };\r\n      reader.readAsText(file);\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Saves file locally, then calls createFromGeoJSON\r\n   * @param {Object} layer Object with processed json data and name\r\n   */\r\n  localSave = layer => {\r\n    let dbsave = db.transaction(LAYER_STORE, \"readwrite\");\r\n    let objstore = dbsave.objectStore(LAYER_STORE);\r\n    let request;\r\n    request = objstore.put(layer);\r\n    request.onsuccess = event => {\r\n      if (layer.id === undefined) {\r\n        layer.id = event.target.result;\r\n        this.addGeoJSONLayer([layer]);\r\n      }\r\n    };\r\n  };\r\n  /**\r\n   * Creates sidebar layer and map layer\r\n   * @param {Layer} layer Layer with name, data and id\r\n   */\r\n  addGeoJSONLayer = layers => {\r\n    layers.forEach(layer => {\r\n      console.log(layer);\r\n      this.setState(prevState => {\r\n        const layers = prevState.layers;\r\n        layers.splice(0, 0, layer);\r\n        let style = prevState.styles.get(layer.id)\r\n          ? prevState.styles.get(layer.id)\r\n          : this.setStyle(layer.id);\r\n        return {\r\n          layers: layers,\r\n          visibility: prevState.visibility.set(layer.id, true),\r\n          styles: prevState.styles.set(layer.id, style)\r\n        };\r\n      });\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Set default style for a layer\r\n   */\r\n  setStyle = id => {\r\n    const opacity = 0.8;\r\n    const color = getColor(id);\r\n    const style = { color: color, opacity: opacity };\r\n    return style;\r\n  };\r\n\r\n  /**\r\n   * Delete layer from storage, sidebar and map\r\n   */\r\n  handleDelete = id => {\r\n    this.deleteFromStorage(id);\r\n    this.deleteFromState(id);\r\n    this.deleteFromLeaflet(id);\r\n  };\r\n  /**\r\n   * Zoom in on one layer\r\n   */\r\n  handleZoom = id => {\r\n    this.leafletmap.current.zoomToLayer(id);\r\n  };\r\n  /**\r\n   * Change name of layer, in both current state and in local storage\r\n   */\r\n  handleNameChange = (layer, name) => {\r\n    if (layer.name !== name && name.length > 0) {\r\n      layer.name = name;\r\n      this.localSave(layer);\r\n    }\r\n  };\r\n  /**\r\n   * Change the layer style (color, opacity) if the changes are not null\r\n   */\r\n  handleStyleChange = (id, style) => {\r\n    this.setState(prevState => {\r\n      let { color, opacity } = style;\r\n      const prevStyle = prevState.styles.get(id);\r\n      color = color !== null ? color : prevStyle.color;\r\n      opacity = opacity !== null ? opacity : prevStyle.opacity;\r\n      return {\r\n        styles: prevState.styles.set(id, {\r\n          color: color,\r\n          opacity: opacity\r\n        })\r\n      };\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Delete layer from indexeddb\r\n   */\r\n  deleteFromStorage = id => {\r\n    let dbdelete = db.transaction(LAYER_STORE, \"readwrite\");\r\n    let objstore = dbdelete.objectStore(LAYER_STORE);\r\n    let request = objstore.delete(id);\r\n    request.onsuccess = event => {\r\n      //console.log(\"Deleted \" + id);\r\n    };\r\n  };\r\n  /**\r\n   * Delete layer from state, which in turn deletes it from the sidebar\r\n   */\r\n  deleteFromState = id => {\r\n    this.setState(prevState => {\r\n      const layers = prevState.layers.filter(l => l.id !== id);\r\n      return { layers: layers };\r\n    });\r\n  };\r\n  /**\r\n   * Delete layer from leaflet\r\n   */\r\n  deleteFromLeaflet = id => {\r\n    this.leafletmap.current.removeLayer(id);\r\n  };\r\n  /**\r\n   * There are some error with the layer, ex: invalid geoJSON, it should be deleted\r\n   */\r\n  handleError = id => {\r\n    this.handleDelete(id);\r\n  };\r\n  /**\r\n   * A layer is dragged to a new position, reorder the layers\r\n   */\r\n  handleMove = (id, newIndex) => {\r\n    this.setState(prevState => {\r\n      const layerInfo = getInfo(id, prevState.layers);\r\n      const layers = prevState.layers;\r\n      layers.splice(layerInfo.index, 1);\r\n      layers.splice(newIndex, 0, layerInfo.info);\r\n      return { layers: layers };\r\n    });\r\n  };\r\n  /**\r\n   * Gets a new layer as a result of a processing operation. Saves it locally\r\n   */\r\n  handleProcessing = layer => {\r\n    this.localSave(layer);\r\n  };\r\n  /**\r\n   * The visibility of a layer is toggled\r\n   */\r\n  handleToggle = id => {\r\n    this.setState(prevState => {\r\n      return {\r\n        visibility: prevState.visibility.set(id, !prevState.visibility.get(id))\r\n      };\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Render function.\r\n   * Contains Sidebar\r\n   * LeafletMap\r\n   */\r\n  render() {\r\n    return (\r\n      <React.Fragment>\r\n        <SideBar\r\n          layerlist={this.state.layers}\r\n          visiblemap={this.state.visibility}\r\n          stylemap={this.state.styles}\r\n          onUpload={this.handleUpload}\r\n          onDelete={this.handleDelete}\r\n          onToggle={this.handleToggle}\r\n          onMove={this.handleMove}\r\n          onZoom={this.handleZoom}\r\n          onNameChange={this.handleNameChange}\r\n          onStyleChange={this.handleStyleChange}\r\n          onProcessingDone={this.handleProcessing}\r\n        />\r\n        <LeafletMap\r\n          ref={this.leafletmap}\r\n          layerlist={this.state.layers}\r\n          visiblemap={this.state.visibility}\r\n          stylemap={this.state.styles}\r\n          onError={this.handleError}\r\n        />\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nApp.propTypes = {\r\n  layers: PropTypes.arrayOf(PropTypes.shape(LayerShape)),\r\n  layer: PropTypes.shape(LayerShape),\r\n  visibility: PropTypes.instanceOf(Map),\r\n  id: PropTypes.number,\r\n  newIndex: PropTypes.number,\r\n  DB_NAME: PropTypes.string,\r\n  LAYER_STORE: PropTypes.string,\r\n  DB_VERSION: PropTypes.number\r\n};\r\n\r\nexport default DragDropContext(HTML5Backend)(App);\r\n","import React, { Component } from \"react\";\r\nimport \"./css/sidebar.css\";\r\nimport PropTypes from \"prop-types\";\r\nimport { OperationShape } from \"./util/constants.js\";\r\nimport ProcessingTemplate from \"./processingtemplate\";\r\nimport {\r\n  operations,\r\n  componentOperations\r\n} from \"./processing/operationtypes.js\";\r\n\r\n/**\r\n * Class for listing all operations, and managing their output\r\n */\r\nclass Geoprocessing extends Component {\r\n  state = {\r\n    operations: operations,\r\n    componentOperations: componentOperations,\r\n    listOpen: null\r\n  };\r\n  /**\r\n   * Toggles which operation is expanded. Only one may be expanded at any time\r\n   */\r\n  handleToggle = name => {\r\n    this.setState(prevState => {\r\n      if (prevState.listOpen === name) {\r\n        return { listOpen: null };\r\n      } else {\r\n        return { listOpen: name };\r\n      }\r\n    });\r\n  };\r\n  /**\r\n   * Create clickable sidebar entity for each operation\r\n   * @param {Object} operation The object describing the operation\r\n   * @param {Boolean} popup If the operation is a whole component, or only a function\r\n   */\r\n  createProcessingTemplate = (operation, popup) => {\r\n    return (\r\n      <ProcessingTemplate\r\n        key={operation.name}\r\n        operation={operation}\r\n        onToggle={this.handleToggle}\r\n        onProcessingDone={this.props.onProcessingDone}\r\n        listOpen={this.state.listOpen === operation.name}\r\n        popup={popup}\r\n      />\r\n    );\r\n  };\r\n  render() {\r\n    return (\r\n      <div>\r\n        <div className=\"group-divider\">Geoprocessing</div>\r\n        {this.state.componentOperations.map(operation =>\r\n          this.createProcessingTemplate(operation, true)\r\n        )}\r\n        {this.state.operations.map(operation =>\r\n          this.createProcessingTemplate(operation, false)\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nGeoprocessing.propTypes = {\r\n  operations: PropTypes.arrayOf(PropTypes.shape(OperationShape)),\r\n  onProcessingDone: PropTypes.func.isRequired\r\n};\r\n\r\nexport default Geoprocessing;\r\n","import React, { Component } from \"react\";\r\nimport Dropzone from \"react-dropzone\";\r\nimport \"./css/sidebar.css\";\r\nimport { ACCEPTED_FILE_TYPES } from \"./util/constants.js\";\r\nimport PropTypes from \"prop-types\";\r\n\r\n/**\r\n * Class for the upload button. Can upload geoJSON files\r\n */\r\nclass Upload extends Component {\r\n  /**\r\n   * Checks file type and chooses convertion function.\r\n   * Can convert geoJSON, possibility for adding GML and Shape later\r\n   * @param files, all input files from user\r\n   */\r\n  handleUpload = files => {\r\n    let geoJsonFiles = [];\r\n    //let gmlFiles = [];\r\n    files.forEach(file => {\r\n      let filename = file.name.toLowerCase();\r\n      if (filename.length > 0) {\r\n        if (filename.endsWith(\".geojson\")) {\r\n          geoJsonFiles.push(file);\r\n        } else {\r\n          /*\r\n        else if (filename.endsWith(\".gml\")) {\r\n          gmlFiles.push(file);\r\n        }\r\n        */\r\n          alert(\"Not valid filetype: \" + filename);\r\n        }\r\n      }\r\n    });\r\n    this.props.onUpload(geoJsonFiles);\r\n  };\r\n\r\n  /**\r\n   * Render function\r\n   * Contains a file upload zone. Can be clicked to open field upload dialogue\r\n   */\r\n  render() {\r\n    return (\r\n      <div>\r\n        <Dropzone\r\n          className=\"drop-zone\"\r\n          accept={ACCEPTED_FILE_TYPES}\r\n          onDrop={files => {\r\n            this.handleUpload(files);\r\n          }}\r\n        >\r\n          <span>Click to upload files. Only geojson files can be uploaded</span>\r\n        </Dropzone>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nUpload.propTypes = {\r\n  onUpload: PropTypes.func.isRequired,\r\n  gmlFiles: PropTypes.array,\r\n  shapeFiles: PropTypes.array,\r\n  geoJsonFiles: PropTypes.array,\r\n  ACCEPTED_FILE_TYPES: PropTypes.string,\r\n  SHAPE_FORMATS: PropTypes.array\r\n};\r\n\r\nexport default Upload;\r\n","import React, { Component } from \"react\";\r\nimport LayerList from \"./layerlist\";\r\nimport Geoprocessing from \"./geoprocessing\";\r\nimport Upload from \"./upload\";\r\nimport \"./css/sidebar.css\";\r\nimport PropTypes from \"prop-types\";\r\nimport { LayerShape } from \"./util/constants\";\r\n\r\n/**\r\n * Class the sidebar. Contains the layers, the operations and the upload file button\r\n */\r\nclass SideBar extends Component {\r\n  /**\r\n   * Render function.\r\n   * Contains list of processing functions\r\n   * List of layers\r\n   * Area for uploading files\r\n   */\r\n  render() {\r\n    return (\r\n      <nav id=\"sidebar\" className=\"navbar bg-light\">\r\n        <Geoprocessing onProcessingDone={this.props.onProcessingDone} />\r\n        <LayerList\r\n          layerlist={this.props.layerlist}\r\n          visiblemap={this.props.visiblemap}\r\n          stylemap={this.props.stylemap}\r\n          onDelete={this.props.onDelete}\r\n          onToggle={this.props.onToggle}\r\n          onMove={this.props.onMove}\r\n          onZoom={this.props.onZoom}\r\n          onNameChange={this.props.onNameChange}\r\n          onStyleChange={this.props.onStyleChange}\r\n        />\r\n        <Upload onUpload={this.props.onUpload} />\r\n      </nav>\r\n    );\r\n  }\r\n}\r\n\r\nSideBar.propTypes = {\r\n  layerlist: PropTypes.arrayOf(PropTypes.shape(LayerShape)),\r\n  visiblemap: PropTypes.instanceOf(Map).isRequired,\r\n  onMove: PropTypes.func.isRequired,\r\n  onUpload: PropTypes.func.isRequired\r\n};\r\n\r\nexport default SideBar;\r\n","import React, { Component } from \"react\";\r\nimport L from \"leaflet\";\r\nimport \"leaflet/dist/leaflet.css\";\r\nimport \"./css/map.css\";\r\nimport PropTypes from \"prop-types\";\r\nimport { LayerShape } from \"./util/constants.js\";\r\n\r\n/**\r\n * Class for all interactions with the leaflet map\r\n */\r\nclass LeafletMap extends Component {\r\n  state = {\r\n    mapid: \"mapid\",\r\n    center: [63.42, 10.39],\r\n    zoom: 14\r\n  };\r\n\r\n  /**\r\n   * Instantiates the map and the featuregroup containing all layers\r\n   */\r\n  componentDidMount() {\r\n    this.map = this.createMap(this.state.mapid);\r\n    this.featuregroup = L.featureGroup();\r\n    this.featuregroup.addTo(this.map);\r\n  }\r\n  /**\r\n   * Leaflet map constructor with Kartverket basemap\r\n   * @param mapid, id of <div> the map will be placed in\r\n   */\r\n  createMap(mapid) {\r\n    let map = L.map(mapid).setView(this.state.center, this.state.zoom);\r\n    L.tileLayer(\r\n      \"https://opencache.statkart.no/gatekeeper/gk/gk.open_gmaps?layers=norges_grunnkart&zoom={z}&x={x}&y={y}\",\r\n      {\r\n        attribution: '<a href=\"http://www.kartverket.no/\">Kartverket</a>'\r\n      }\r\n    ).addTo(map);\r\n    map.zoomControl.setPosition(\"topright\");\r\n\r\n    return map;\r\n  }\r\n  /**\r\n   * When props are updated:\r\n   * Goes through each layer, checks the visibility settings,\r\n   * adds layers and pushes them to the back, starting with the front layers\r\n   */\r\n  componentDidUpdate() {\r\n    this.props.layerlist.forEach(layer => {\r\n      //Layer is visible, add and bring to back\r\n      if (this.props.visiblemap.get(layer.id)) {\r\n        let leaflayer = this.addLayer(layer);\r\n        let style = this.props.stylemap.get(layer.id);\r\n        leaflayer.setStyle({ color: style.color, opacity: style.opacity });\r\n        leaflayer.bringToBack();\r\n      }\r\n      //Layer is not visible, remove\r\n      else {\r\n        this.removeLayer(layer.id);\r\n      }\r\n    });\r\n  }\r\n\r\n  zoomToLayer = id => {\r\n    const layer = this.getLayerById(id);\r\n    this.map.fitBounds(layer.getBounds());\r\n  };\r\n  /**\r\n   * Inserts data as geojson layer. Adds id field for easier identification.\r\n   * If leaflet cannot read the layer, delete it from storage\r\n   * @param {*} layer\r\n   */\r\n  addLayer = layer => {\r\n    let leaflayer = this.getLayerById(layer.id);\r\n    if (leaflayer === undefined) {\r\n      try {\r\n        leaflayer = L.geoJSON(layer.data);\r\n        leaflayer.id = layer.id;\r\n        this.featuregroup.addLayer(leaflayer);\r\n      } catch (e) {\r\n        this.props.onError(layer.id);\r\n      }\r\n    }\r\n    return leaflayer;\r\n  };\r\n  /**\r\n   * Finds and removes layer in feature group with id matching input id\r\n   * @param {*} id\r\n   */\r\n  removeLayer = id => {\r\n    const layer = this.getLayerById(id);\r\n    if (layer !== undefined) {\r\n      this.featuregroup.removeLayer(layer);\r\n    }\r\n  };\r\n  getLayerById = id => {\r\n    return this.featuregroup.getLayers().find(layer => layer.id === id);\r\n  };\r\n  render() {\r\n    return <div id={this.state.mapid} />;\r\n  }\r\n}\r\n\r\nLeafletMap.propTypes = {\r\n  layerlist: PropTypes.arrayOf(PropTypes.shape(LayerShape)),\r\n  visiblemap: PropTypes.instanceOf(Map).isRequired,\r\n  layer: PropTypes.shape(LayerShape),\r\n  map: PropTypes.object\r\n};\r\n\r\nexport default LeafletMap;\r\n","// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport default function register() {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Lets check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://goo.gl/SC7cgQ'\n          );\n        });\n      } else {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the old content will have been purged and\n              // the fresh content will have been added to the cache.\n              // It's the perfect time to display a \"New content is\n              // available; please refresh.\" message in your web app.\n              console.log('New content is available; please refresh.');\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get('content-type').indexOf('javascript') === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import \"@babel/polyfill\";\r\nimport \"indexeddb-getall-shim\";\r\nimport \"bootstrap/dist/css/bootstrap.min.css\";\r\nimport React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport \"./index.css\";\r\nimport App from \"./App\";\r\n\r\nimport registerServiceWorker from \"./registerServiceWorker\";\r\n\r\nReactDOM.render(<App />, document.getElementById(\"root\"));\r\nregisterServiceWorker();\r\n","module.exports = __webpack_public_path__ + \"static/media/icondelete.d36bd4a7.svg\";"],"sourceRoot":""}